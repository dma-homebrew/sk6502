<!DOCTYPE html>
<html>
<head>
<title>C64 ROM: Routine at B86A</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html">C64 ROM</a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="B862.html">B862</a>
</td>
<td class="up">Up: <a href="../maps/all.html#B86A">Map</a></td>
<td class="next">
Next: <a href="B8D2.html">B8D2</a>
</td>
</tr>
</table>
<div class="description">B86A: add FAC2 to FAC1</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="B853.html">B853</a> and <a href="BD7E.html">BD7E</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="B86A"></span>B86A</td>
<td class="bytes">D0 03</td>
<td class="instruction">BNE <a href="B86A.html#B86F">$B86F</a></td>
<td class="comment-1" rowspan="1">branch if FAC1 is not zero</td>
</tr>
<tr>
<td class="address-1"><span id="B86C"></span>B86C</td>
<td class="bytes">4C FC BB</td>
<td class="instruction">JMP <a href="BBFC.html">$BBFC</a></td>
<td class="comment-1" rowspan="1">FAC1 was zero so copy FAC2 to FAC1 and return</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="B86F"></span>
<div class="comments">
<div class="paragraph">
FAC1 is non zero
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="B86F"></span>B86F</td>
<td class="bytes">A6 70</td>
<td class="instruction">LDX $70</td>
<td class="comment-1" rowspan="1">get FAC1 rounding byte</td>
</tr>
<tr>
<td class="address-1"><span id="B871"></span>B871</td>
<td class="bytes">86 56</td>
<td class="instruction">STX $56</td>
<td class="comment-1" rowspan="1">save as FAC2 rounding byte</td>
</tr>
<tr>
<td class="address-1"><span id="B873"></span>B873</td>
<td class="bytes">A2 69</td>
<td class="instruction">LDX #$69</td>
<td class="comment-1" rowspan="1">set index to FAC2 exponent address</td>
</tr>
<tr>
<td class="address-1"><span id="B875"></span>B875</td>
<td class="bytes">A5 69</td>
<td class="instruction">LDA $69</td>
<td class="comment-1" rowspan="1">get FAC2 exponent</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="B877"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="BAE2.html">BAE2</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="B877"></span>B877</td>
<td class="bytes">A8</td>
<td class="instruction">TAY</td>
<td class="comment-1" rowspan="1">copy exponent</td>
</tr>
<tr>
<td class="address-1"><span id="B878"></span>B878</td>
<td class="bytes">F0 CE</td>
<td class="instruction">BEQ <a href="B82D.html#B848">$B848</a></td>
<td class="comment-1" rowspan="1">exit if zero</td>
</tr>
<tr>
<td class="address-1"><span id="B87A"></span>B87A</td>
<td class="bytes">38</td>
<td class="instruction">SEC</td>
<td class="comment-1" rowspan="1">set carry for subtract</td>
</tr>
<tr>
<td class="address-1"><span id="B87B"></span>B87B</td>
<td class="bytes">E5 61</td>
<td class="instruction">SBC $61</td>
<td class="comment-1" rowspan="1">subtract FAC1 exponent</td>
</tr>
<tr>
<td class="address-1"><span id="B87D"></span>B87D</td>
<td class="bytes">F0 24</td>
<td class="instruction">BEQ <a href="B86A.html#B8A3">$B8A3</a></td>
<td class="comment-1" rowspan="1">if equal go add mantissas</td>
</tr>
<tr>
<td class="address-1"><span id="B87F"></span>B87F</td>
<td class="bytes">90 12</td>
<td class="instruction">BCC <a href="B86A.html#B893">$B893</a></td>
<td class="comment-1" rowspan="1">if FAC2 &lt; FAC1 then go shift FAC2 right</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="B881"></span>
<div class="comments">
<div class="paragraph">
else FAC2 &gt; FAC1
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="B881"></span>B881</td>
<td class="bytes">84 61</td>
<td class="instruction">STY $61</td>
<td class="comment-1" rowspan="1">save FAC1 exponent</td>
</tr>
<tr>
<td class="address-1"><span id="B883"></span>B883</td>
<td class="bytes">A4 6E</td>
<td class="instruction">LDY $6E</td>
<td class="comment-1" rowspan="1">get FAC2 sign (b7)</td>
</tr>
<tr>
<td class="address-1"><span id="B885"></span>B885</td>
<td class="bytes">84 66</td>
<td class="instruction">STY $66</td>
<td class="comment-1" rowspan="1">save FAC1 sign (b7)</td>
</tr>
<tr>
<td class="address-1"><span id="B887"></span>B887</td>
<td class="bytes">49 FF</td>
<td class="instruction">EOR #$FF</td>
<td class="comment-1" rowspan="1">complement <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="B889"></span>B889</td>
<td class="bytes">69 00</td>
<td class="instruction">ADC #$00</td>
<td class="comment-1" rowspan="1">+1, twos complement, carry is set</td>
</tr>
<tr>
<td class="address-1"><span id="B88B"></span>B88B</td>
<td class="bytes">A0 00</td>
<td class="instruction">LDY #$00</td>
<td class="comment-1" rowspan="1">clear <span class="register">Y</span></td>
</tr>
<tr>
<td class="address-1"><span id="B88D"></span>B88D</td>
<td class="bytes">84 56</td>
<td class="instruction">STY $56</td>
<td class="comment-1" rowspan="1">clear FAC2 rounding byte</td>
</tr>
<tr>
<td class="address-1"><span id="B88F"></span>B88F</td>
<td class="bytes">A2 61</td>
<td class="instruction">LDX #$61</td>
<td class="comment-1" rowspan="1">set index to FAC1 exponent address</td>
</tr>
<tr>
<td class="address-1"><span id="B891"></span>B891</td>
<td class="bytes">D0 04</td>
<td class="instruction">BNE <a href="B86A.html#B897">$B897</a></td>
<td class="comment-1" rowspan="1">branch always</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="B893"></span>
<div class="comments">
<div class="paragraph">
FAC2 &lt; FAC1
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="B893"></span>B893</td>
<td class="bytes">A0 00</td>
<td class="instruction">LDY #$00</td>
<td class="comment-1" rowspan="1">clear <span class="register">Y</span></td>
</tr>
<tr>
<td class="address-1"><span id="B895"></span>B895</td>
<td class="bytes">84 70</td>
<td class="instruction">STY $70</td>
<td class="comment-1" rowspan="1">clear FAC1 rounding byte</td>
</tr>
<tr>
<td class="address-2"><span id="B897"></span>B897</td>
<td class="bytes">C9 F9</td>
<td class="instruction">CMP #$F9</td>
<td class="comment-1" rowspan="1">compare exponent diff with $F9</td>
</tr>
<tr>
<td class="address-1"><span id="B899"></span>B899</td>
<td class="bytes">30 C7</td>
<td class="instruction">BMI <a href="B862.html">$B862</a></td>
<td class="comment-1" rowspan="1">branch if range $79-$F8</td>
</tr>
<tr>
<td class="address-1"><span id="B89B"></span>B89B</td>
<td class="bytes">A8</td>
<td class="instruction">TAY</td>
<td class="comment-1" rowspan="1">copy exponent difference to <span class="register">Y</span></td>
</tr>
<tr>
<td class="address-1"><span id="B89C"></span>B89C</td>
<td class="bytes">A5 70</td>
<td class="instruction">LDA $70</td>
<td class="comment-1" rowspan="1">get FAC1 rounding byte</td>
</tr>
<tr>
<td class="address-1"><span id="B89E"></span>B89E</td>
<td class="bytes">56 01</td>
<td class="instruction">LSR $01,X</td>
<td class="comment-1" rowspan="1">shift FAC? mantissa 1</td>
</tr>
<tr>
<td class="address-1"><span id="B8A0"></span>B8A0</td>
<td class="bytes">20 B0 B9</td>
<td class="instruction">JSR <a href="B983.html#B9B0">$B9B0</a></td>
<td class="comment-1" rowspan="1">shift FACX <span class="register">Y</span> times right</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="B8A3"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="B862.html">B862</a>.
</div>
<div class="paragraph">
exponents are equal now do mantissa subtract
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="B8A3"></span>B8A3</td>
<td class="bytes">24 6F</td>
<td class="instruction">BIT $6F</td>
<td class="comment-1" rowspan="1">test sign compare (FAC1 EOR FAC2)</td>
</tr>
<tr>
<td class="address-1"><span id="B8A5"></span>B8A5</td>
<td class="bytes">10 57</td>
<td class="instruction">BPL <a href="B8FE.html">$B8FE</a></td>
<td class="comment-1" rowspan="1">if = add FAC2 mantissa to FAC1 mantissa and return</td>
</tr>
<tr>
<td class="address-1"><span id="B8A7"></span>B8A7</td>
<td class="bytes">A0 61</td>
<td class="instruction">LDY #$61</td>
<td class="comment-1" rowspan="1">set the <span class="register">Y</span> index to FAC1 exponent address</td>
</tr>
<tr>
<td class="address-1"><span id="B8A9"></span>B8A9</td>
<td class="bytes">E0 69</td>
<td class="instruction">CPX #$69</td>
<td class="comment-1" rowspan="1">compare <span class="register">X</span> to FAC2 exponent address</td>
</tr>
<tr>
<td class="address-1"><span id="B8AB"></span>B8AB</td>
<td class="bytes">F0 02</td>
<td class="instruction">BEQ <a href="B86A.html#B8AF">$B8AF</a></td>
<td class="comment-1" rowspan="1">if = continue, <span class="register">Y</span> = FAC1, <span class="register">X</span> = FAC2</td>
</tr>
<tr>
<td class="address-1"><span id="B8AD"></span>B8AD</td>
<td class="bytes">A0 69</td>
<td class="instruction">LDY #$69</td>
<td class="comment-1" rowspan="1">else set the <span class="register">Y</span> index to FAC2 exponent address</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="B8AF"></span>
<div class="comments">
<div class="paragraph">
subtract the smaller from the bigger (take the sign of the bigger)
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="B8AF"></span>B8AF</td>
<td class="bytes">38</td>
<td class="instruction">SEC</td>
<td class="comment-1" rowspan="1">set carry for subtract</td>
</tr>
<tr>
<td class="address-1"><span id="B8B0"></span>B8B0</td>
<td class="bytes">49 FF</td>
<td class="instruction">EOR #$FF</td>
<td class="comment-1" rowspan="1">ones complement <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="B8B2"></span>B8B2</td>
<td class="bytes">65 56</td>
<td class="instruction">ADC $56</td>
<td class="comment-1" rowspan="1">add FAC2 rounding byte</td>
</tr>
<tr>
<td class="address-1"><span id="B8B4"></span>B8B4</td>
<td class="bytes">85 70</td>
<td class="instruction">STA $70</td>
<td class="comment-1" rowspan="1">save FAC1 rounding byte</td>
</tr>
<tr>
<td class="address-1"><span id="B8B6"></span>B8B6</td>
<td class="bytes">B9 04 00</td>
<td class="instruction">LDA $0004,Y</td>
<td class="comment-1" rowspan="1">get FACY mantissa 4</td>
</tr>
<tr>
<td class="address-1"><span id="B8B9"></span>B8B9</td>
<td class="bytes">F5 04</td>
<td class="instruction">SBC $04,X</td>
<td class="comment-1" rowspan="1">subtract FACX mantissa 4</td>
</tr>
<tr>
<td class="address-1"><span id="B8BB"></span>B8BB</td>
<td class="bytes">85 65</td>
<td class="instruction">STA $65</td>
<td class="comment-1" rowspan="1">save FAC1 mantissa 4</td>
</tr>
<tr>
<td class="address-1"><span id="B8BD"></span>B8BD</td>
<td class="bytes">B9 03 00</td>
<td class="instruction">LDA $0003,Y</td>
<td class="comment-1" rowspan="1">get FACY mantissa 3</td>
</tr>
<tr>
<td class="address-1"><span id="B8C0"></span>B8C0</td>
<td class="bytes">F5 03</td>
<td class="instruction">SBC $03,X</td>
<td class="comment-1" rowspan="1">subtract FACX mantissa 3</td>
</tr>
<tr>
<td class="address-1"><span id="B8C2"></span>B8C2</td>
<td class="bytes">85 64</td>
<td class="instruction">STA $64</td>
<td class="comment-1" rowspan="1">save FAC1 mantissa 3</td>
</tr>
<tr>
<td class="address-1"><span id="B8C4"></span>B8C4</td>
<td class="bytes">B9 02 00</td>
<td class="instruction">LDA $0002,Y</td>
<td class="comment-1" rowspan="1">get FACY mantissa 2</td>
</tr>
<tr>
<td class="address-1"><span id="B8C7"></span>B8C7</td>
<td class="bytes">F5 02</td>
<td class="instruction">SBC $02,X</td>
<td class="comment-1" rowspan="1">subtract FACX mantissa 2</td>
</tr>
<tr>
<td class="address-1"><span id="B8C9"></span>B8C9</td>
<td class="bytes">85 63</td>
<td class="instruction">STA $63</td>
<td class="comment-1" rowspan="1">save FAC1 mantissa 2</td>
</tr>
<tr>
<td class="address-1"><span id="B8CB"></span>B8CB</td>
<td class="bytes">B9 01 00</td>
<td class="instruction">LDA $0001,Y</td>
<td class="comment-1" rowspan="1">get FACY mantissa 1</td>
</tr>
<tr>
<td class="address-1"><span id="B8CE"></span>B8CE</td>
<td class="bytes">F5 01</td>
<td class="instruction">SBC $01,X</td>
<td class="comment-1" rowspan="1">subtract FACX mantissa 1</td>
</tr>
<tr>
<td class="address-1"><span id="B8D0"></span>B8D0</td>
<td class="bytes">85 62</td>
<td class="instruction">STA $62</td>
<td class="comment-1" rowspan="1">save FAC1 mantissa 1</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="B862.html">B862</a>
</td>
<td class="up">Up: <a href="../maps/all.html#B86A">Map</a></td>
<td class="next">
Next: <a href="B8D2.html">B8D2</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&#169; 2012 Lee Davison.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.0 and <a href="https://github.com/skoolkid/sk6502">sk6502</a>.</div>
</footer>
</body>
</html>