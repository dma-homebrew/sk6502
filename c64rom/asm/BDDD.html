<!DOCTYPE html>
<html>
<head>
<title>C64 ROM: Routine at BDDD</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html">C64 ROM</a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="BDCD.html">BDCD</a>
</td>
<td class="up">Up: <a href="../maps/all.html#BDDD">Map</a></td>
<td class="next">
Next: <a href="BF11.html">BF11</a>
</td>
</tr>
</table>
<div class="description">BDDD: convert FAC1 to ASCII string result in (<span class="register">AY</span>)</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="AAA0.html">AAA0</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="BDDD"></span>BDDD</td>
<td class="bytes">A0 01</td>
<td class="instruction">LDY #$01</td>
<td class="comment-1" rowspan="1">set index = 1</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="BDDF"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routines at <a href="B465.html">B465</a> and <a href="BDCD.html">BDCD</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="BDDF"></span>BDDF</td>
<td class="bytes">A9 20</td>
<td class="instruction">LDA #" "</td>
<td class="comment-1" rowspan="1">character = " " (assume +ve)</td>
</tr>
<tr>
<td class="address-1"><span id="BDE1"></span>BDE1</td>
<td class="bytes">24 66</td>
<td class="instruction">BIT $66</td>
<td class="comment-1" rowspan="1">test FAC1 sign (b7)</td>
</tr>
<tr>
<td class="address-1"><span id="BDE3"></span>BDE3</td>
<td class="bytes">10 02</td>
<td class="instruction">BPL <a href="BDDD.html#BDE7">$BDE7</a></td>
<td class="comment-1" rowspan="1">branch if +ve</td>
</tr>
<tr>
<td class="address-1"><span id="BDE5"></span>BDE5</td>
<td class="bytes">A9 2D</td>
<td class="instruction">LDA #"-"</td>
<td class="comment-1" rowspan="1">else character = "-"</td>
</tr>
<tr>
<td class="address-2"><span id="BDE7"></span>BDE7</td>
<td class="bytes">99 FF 00</td>
<td class="instruction">STA $00FF,Y</td>
<td class="comment-1" rowspan="1">save leading character (" " or "-")</td>
</tr>
<tr>
<td class="address-1"><span id="BDEA"></span>BDEA</td>
<td class="bytes">85 66</td>
<td class="instruction">STA $66</td>
<td class="comment-1" rowspan="1">save FAC1 sign (b7)</td>
</tr>
<tr>
<td class="address-1"><span id="BDEC"></span>BDEC</td>
<td class="bytes">84 71</td>
<td class="instruction">STY $71</td>
<td class="comment-1" rowspan="1">save index</td>
</tr>
<tr>
<td class="address-1"><span id="BDEE"></span>BDEE</td>
<td class="bytes">C8</td>
<td class="instruction">INY</td>
<td class="comment-1" rowspan="1">increment index</td>
</tr>
<tr>
<td class="address-1"><span id="BDEF"></span>BDEF</td>
<td class="bytes">A9 30</td>
<td class="instruction">LDA #"0"</td>
<td class="comment-1" rowspan="1">set character = "0"</td>
</tr>
<tr>
<td class="address-1"><span id="BDF1"></span>BDF1</td>
<td class="bytes">A6 61</td>
<td class="instruction">LDX $61</td>
<td class="comment-1" rowspan="1">get FAC1 exponent</td>
</tr>
<tr>
<td class="address-1"><span id="BDF3"></span>BDF3</td>
<td class="bytes">D0 03</td>
<td class="instruction">BNE <a href="BDDD.html#BDF8">$BDF8</a></td>
<td class="comment-1" rowspan="1">branch if FAC1&lt;&gt;0</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="BDF5"></span>
<div class="comments">
<div class="paragraph">
exponent was $00 so FAC1 is 0
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="BDF5"></span>BDF5</td>
<td class="bytes">4C 04 BF</td>
<td class="instruction">JMP <a href="BDDD.html#BF04">$BF04</a></td>
<td class="comment-1" rowspan="1">save last character, [EOT] and exit</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="BDF8"></span>
<div class="comments">
<div class="paragraph">
FAC1 is some non zero value
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="BDF8"></span>BDF8</td>
<td class="bytes">A9 00</td>
<td class="instruction">LDA #$00</td>
<td class="comment-1" rowspan="1">clear (number exponent count)</td>
</tr>
<tr>
<td class="address-1"><span id="BDFA"></span>BDFA</td>
<td class="bytes">E0 80</td>
<td class="instruction">CPX #$80</td>
<td class="comment-1" rowspan="1">compare FAC1 exponent with $80 (&lt;1.00000)</td>
</tr>
<tr>
<td class="address-1"><span id="BDFC"></span>BDFC</td>
<td class="bytes">F0 02</td>
<td class="instruction">BEQ <a href="BDDD.html#BE00">$BE00</a></td>
<td class="comment-1" rowspan="1">branch if 0.5 &lt;= FAC1 &lt; 1.0</td>
</tr>
<tr>
<td class="address-1"><span id="BDFE"></span>BDFE</td>
<td class="bytes">B0 09</td>
<td class="instruction">BCS <a href="BDDD.html#BE09">$BE09</a></td>
<td class="comment-1" rowspan="1">branch if FAC1=&gt;1</td>
</tr>
<tr>
<td class="address-2"><span id="BE00"></span>BE00</td>
<td class="bytes">A9 BD</td>
<td class="instruction">LDA #$BD</td>
<td class="comment-1" rowspan="1">set 1000000000 pointer low byte</td>
</tr>
<tr>
<td class="address-1"><span id="BE02"></span>BE02</td>
<td class="bytes">A0 BD</td>
<td class="instruction">LDY #$BD</td>
<td class="comment-1" rowspan="1">set 1000000000 pointer high byte</td>
</tr>
<tr>
<td class="address-1"><span id="BE04"></span>BE04</td>
<td class="bytes">20 28 BA</td>
<td class="instruction">JSR <a href="BA28.html">$BA28</a></td>
<td class="comment-1" rowspan="1">do convert <span class="register">AY</span>, FCA1*(<span class="register">AY</span>)</td>
</tr>
<tr>
<td class="address-1"><span id="BE07"></span>BE07</td>
<td class="bytes">A9 F7</td>
<td class="instruction">LDA #$F7</td>
<td class="comment-1" rowspan="1">set number exponent count</td>
</tr>
<tr>
<td class="address-2"><span id="BE09"></span>BE09</td>
<td class="bytes">85 5D</td>
<td class="instruction">STA $5D</td>
<td class="comment-1" rowspan="1">save number exponent count</td>
</tr>
<tr>
<td class="address-2"><span id="BE0B"></span>BE0B</td>
<td class="bytes">A9 B8</td>
<td class="instruction">LDA #$B8</td>
<td class="comment-1" rowspan="1">set 999999999.25 pointer low byte (max before sci note)</td>
</tr>
<tr>
<td class="address-1"><span id="BE0D"></span>BE0D</td>
<td class="bytes">A0 BD</td>
<td class="instruction">LDY #$BD</td>
<td class="comment-1" rowspan="1">set 999999999.25 pointer high byte</td>
</tr>
<tr>
<td class="address-1"><span id="BE0F"></span>BE0F</td>
<td class="bytes">20 5B BC</td>
<td class="instruction">JSR <a href="BC5B.html">$BC5B</a></td>
<td class="comment-1" rowspan="1">compare FAC1 with (<span class="register">AY</span>)</td>
</tr>
<tr>
<td class="address-1"><span id="BE12"></span>BE12</td>
<td class="bytes">F0 1E</td>
<td class="instruction">BEQ <a href="BDDD.html#BE32">$BE32</a></td>
<td class="comment-1" rowspan="1">exit if FAC1 = (<span class="register">AY</span>)</td>
</tr>
<tr>
<td class="address-1"><span id="BE14"></span>BE14</td>
<td class="bytes">10 12</td>
<td class="instruction">BPL <a href="BDDD.html#BE28">$BE28</a></td>
<td class="comment-1" rowspan="1">go do /10 if FAC1 &gt; (<span class="register">AY</span>)</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="BE16"></span>
<div class="comments">
<div class="paragraph">
FAC1 &lt; (<span class="register">AY</span>)
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="BE16"></span>BE16</td>
<td class="bytes">A9 B3</td>
<td class="instruction">LDA #$B3</td>
<td class="comment-1" rowspan="1">set 99999999.90625 pointer low byte</td>
</tr>
<tr>
<td class="address-1"><span id="BE18"></span>BE18</td>
<td class="bytes">A0 BD</td>
<td class="instruction">LDY #$BD</td>
<td class="comment-1" rowspan="1">set 99999999.90625 pointer high byte</td>
</tr>
<tr>
<td class="address-1"><span id="BE1A"></span>BE1A</td>
<td class="bytes">20 5B BC</td>
<td class="instruction">JSR <a href="BC5B.html">$BC5B</a></td>
<td class="comment-1" rowspan="1">compare FAC1 with (<span class="register">AY</span>)</td>
</tr>
<tr>
<td class="address-1"><span id="BE1D"></span>BE1D</td>
<td class="bytes">F0 02</td>
<td class="instruction">BEQ <a href="BDDD.html#BE21">$BE21</a></td>
<td class="comment-1" rowspan="1">branch if FAC1 = (<span class="register">AY</span>) (allow decimal places)</td>
</tr>
<tr>
<td class="address-1"><span id="BE1F"></span>BE1F</td>
<td class="bytes">10 0E</td>
<td class="instruction">BPL <a href="BDDD.html#BE2F">$BE2F</a></td>
<td class="comment-1" rowspan="1">branch if FAC1 &gt; (<span class="register">AY</span>) (no decimal places)</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="BE21"></span>
<div class="comments">
<div class="paragraph">
FAC1 &lt;= (<span class="register">AY</span>)
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="BE21"></span>BE21</td>
<td class="bytes">20 E2 BA</td>
<td class="instruction">JSR <a href="BAE2.html">$BAE2</a></td>
<td class="comment-1" rowspan="1">multiply FAC1 by 10</td>
</tr>
<tr>
<td class="address-1"><span id="BE24"></span>BE24</td>
<td class="bytes">C6 5D</td>
<td class="instruction">DEC $5D</td>
<td class="comment-1" rowspan="1">decrement number exponent count</td>
</tr>
<tr>
<td class="address-1"><span id="BE26"></span>BE26</td>
<td class="bytes">D0 EE</td>
<td class="instruction">BNE <a href="BDDD.html#BE16">$BE16</a></td>
<td class="comment-1" rowspan="1">go test again, branch always</td>
</tr>
<tr>
<td class="address-2"><span id="BE28"></span>BE28</td>
<td class="bytes">20 FE BA</td>
<td class="instruction">JSR <a href="BAFE.html">$BAFE</a></td>
<td class="comment-1" rowspan="1">divide FAC1 by 10</td>
</tr>
<tr>
<td class="address-1"><span id="BE2B"></span>BE2B</td>
<td class="bytes">E6 5D</td>
<td class="instruction">INC $5D</td>
<td class="comment-1" rowspan="1">increment number exponent count</td>
</tr>
<tr>
<td class="address-1"><span id="BE2D"></span>BE2D</td>
<td class="bytes">D0 DC</td>
<td class="instruction">BNE <a href="BDDD.html#BE0B">$BE0B</a></td>
<td class="comment-1" rowspan="1">go test again, branch always</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="BE2F"></span>
<div class="comments">
<div class="paragraph">
now we have just the digits to do
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="BE2F"></span>BE2F</td>
<td class="bytes">20 49 B8</td>
<td class="instruction">JSR <a href="B849.html">$B849</a></td>
<td class="comment-1" rowspan="1">add 0.5 to FAC1 (round FAC1)</td>
</tr>
<tr>
<td class="address-2"><span id="BE32"></span>BE32</td>
<td class="bytes">20 9B BC</td>
<td class="instruction">JSR <a href="BC9B.html">$BC9B</a></td>
<td class="comment-1" rowspan="1">convert FAC1 floating to fixed</td>
</tr>
<tr>
<td class="address-1"><span id="BE35"></span>BE35</td>
<td class="bytes">A2 01</td>
<td class="instruction">LDX #$01</td>
<td class="comment-1" rowspan="1">set default digits before dp = 1</td>
</tr>
<tr>
<td class="address-1"><span id="BE37"></span>BE37</td>
<td class="bytes">A5 5D</td>
<td class="instruction">LDA $5D</td>
<td class="comment-1" rowspan="1">get number exponent count</td>
</tr>
<tr>
<td class="address-1"><span id="BE39"></span>BE39</td>
<td class="bytes">18</td>
<td class="instruction">CLC</td>
<td class="comment-1" rowspan="1">clear carry for add</td>
</tr>
<tr>
<td class="address-1"><span id="BE3A"></span>BE3A</td>
<td class="bytes">69 0A</td>
<td class="instruction">ADC #$0A</td>
<td class="comment-1" rowspan="1">up to 9 digits before point</td>
</tr>
<tr>
<td class="address-1"><span id="BE3C"></span>BE3C</td>
<td class="bytes">30 09</td>
<td class="instruction">BMI <a href="BDDD.html#BE47">$BE47</a></td>
<td class="comment-1" rowspan="1">if -ve then 1 digit before dp</td>
</tr>
<tr>
<td class="address-1"><span id="BE3E"></span>BE3E</td>
<td class="bytes">C9 0B</td>
<td class="instruction">CMP #$0B</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>&gt;=$0B if n&gt;=1E9</td>
</tr>
<tr>
<td class="address-1"><span id="BE40"></span>BE40</td>
<td class="bytes">B0 06</td>
<td class="instruction">BCS <a href="BDDD.html#BE48">$BE48</a></td>
<td class="comment-1" rowspan="1">branch if &gt;= $0B</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="BE42"></span>
<div class="comments">
<div class="paragraph">
carry is clear
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="BE42"></span>BE42</td>
<td class="bytes">69 FF</td>
<td class="instruction">ADC #$FF</td>
<td class="comment-1" rowspan="1">take 1 from digit count</td>
</tr>
<tr>
<td class="address-1"><span id="BE44"></span>BE44</td>
<td class="bytes">AA</td>
<td class="instruction">TAX</td>
<td class="comment-1" rowspan="1">copy to <span class="register">X</span></td>
</tr>
<tr>
<td class="address-1"><span id="BE45"></span>BE45</td>
<td class="bytes">A9 02</td>
<td class="instruction">LDA #$02</td>
<td class="comment-1" rowspan="1">set exponent adjust</td>
</tr>
<tr>
<td class="address-2"><span id="BE47"></span>BE47</td>
<td class="bytes">38</td>
<td class="instruction">SEC</td>
<td class="comment-1" rowspan="1">set carry for subtract</td>
</tr>
<tr>
<td class="address-2"><span id="BE48"></span>BE48</td>
<td class="bytes">E9 02</td>
<td class="instruction">SBC #$02</td>
<td class="comment-1" rowspan="1">-2</td>
</tr>
<tr>
<td class="address-1"><span id="BE4A"></span>BE4A</td>
<td class="bytes">85 5E</td>
<td class="instruction">STA $5E</td>
<td class="comment-1" rowspan="1">save exponent adjust</td>
</tr>
<tr>
<td class="address-1"><span id="BE4C"></span>BE4C</td>
<td class="bytes">86 5D</td>
<td class="instruction">STX $5D</td>
<td class="comment-1" rowspan="1">save digits before dp count</td>
</tr>
<tr>
<td class="address-1"><span id="BE4E"></span>BE4E</td>
<td class="bytes">8A</td>
<td class="instruction">TXA</td>
<td class="comment-1" rowspan="1">copy to <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="BE4F"></span>BE4F</td>
<td class="bytes">F0 02</td>
<td class="instruction">BEQ <a href="BDDD.html#BE53">$BE53</a></td>
<td class="comment-1" rowspan="1">branch if no digits before dp</td>
</tr>
<tr>
<td class="address-1"><span id="BE51"></span>BE51</td>
<td class="bytes">10 13</td>
<td class="instruction">BPL <a href="BDDD.html#BE66">$BE66</a></td>
<td class="comment-1" rowspan="1">branch if digits before dp</td>
</tr>
<tr>
<td class="address-2"><span id="BE53"></span>BE53</td>
<td class="bytes">A4 71</td>
<td class="instruction">LDY $71</td>
<td class="comment-1" rowspan="1">get output string index</td>
</tr>
<tr>
<td class="address-1"><span id="BE55"></span>BE55</td>
<td class="bytes">A9 2E</td>
<td class="instruction">LDA #"."</td>
<td class="comment-1" rowspan="1">character "."</td>
</tr>
<tr>
<td class="address-1"><span id="BE57"></span>BE57</td>
<td class="bytes">C8</td>
<td class="instruction">INY</td>
<td class="comment-1" rowspan="1">increment index</td>
</tr>
<tr>
<td class="address-1"><span id="BE58"></span>BE58</td>
<td class="bytes">99 FF 00</td>
<td class="instruction">STA $00FF,Y</td>
<td class="comment-1" rowspan="1">save to output string</td>
</tr>
<tr>
<td class="address-1"><span id="BE5B"></span>BE5B</td>
<td class="bytes">8A</td>
<td class="instruction">TXA</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="BE5C"></span>BE5C</td>
<td class="bytes">F0 06</td>
<td class="instruction">BEQ <a href="BDDD.html#BE64">$BE64</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="BE5E"></span>BE5E</td>
<td class="bytes">A9 30</td>
<td class="instruction">LDA #"0"</td>
<td class="comment-1" rowspan="1">character "0"</td>
</tr>
<tr>
<td class="address-1"><span id="BE60"></span>BE60</td>
<td class="bytes">C8</td>
<td class="instruction">INY</td>
<td class="comment-1" rowspan="1">increment index</td>
</tr>
<tr>
<td class="address-1"><span id="BE61"></span>BE61</td>
<td class="bytes">99 FF 00</td>
<td class="instruction">STA $00FF,Y</td>
<td class="comment-1" rowspan="1">save to output string</td>
</tr>
<tr>
<td class="address-2"><span id="BE64"></span>BE64</td>
<td class="bytes">84 71</td>
<td class="instruction">STY $71</td>
<td class="comment-1" rowspan="1">save output string index</td>
</tr>
<tr>
<td class="address-2"><span id="BE66"></span>BE66</td>
<td class="bytes">A0 00</td>
<td class="instruction">LDY #$00</td>
<td class="comment-1" rowspan="1">clear index (point to 100,000)</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="BE68"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="AF28.html">AF28</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="BE68"></span>BE68</td>
<td class="bytes">A2 80</td>
<td class="instruction">LDX #$80</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-2"><span id="BE6A"></span>BE6A</td>
<td class="bytes">A5 65</td>
<td class="instruction">LDA $65</td>
<td class="comment-1" rowspan="1">get FAC1 mantissa 4</td>
</tr>
<tr>
<td class="address-1"><span id="BE6C"></span>BE6C</td>
<td class="bytes">18</td>
<td class="instruction">CLC</td>
<td class="comment-1" rowspan="1">clear carry for add</td>
</tr>
<tr>
<td class="address-1"><span id="BE6D"></span>BE6D</td>
<td class="bytes">79 19 BF</td>
<td class="instruction">ADC $BF19,Y</td>
<td class="comment-1" rowspan="1">add byte 4, least significant</td>
</tr>
<tr>
<td class="address-1"><span id="BE70"></span>BE70</td>
<td class="bytes">85 65</td>
<td class="instruction">STA $65</td>
<td class="comment-1" rowspan="1">save FAC1 mantissa4</td>
</tr>
<tr>
<td class="address-1"><span id="BE72"></span>BE72</td>
<td class="bytes">A5 64</td>
<td class="instruction">LDA $64</td>
<td class="comment-1" rowspan="1">get FAC1 mantissa 3</td>
</tr>
<tr>
<td class="address-1"><span id="BE74"></span>BE74</td>
<td class="bytes">79 18 BF</td>
<td class="instruction">ADC $BF18,Y</td>
<td class="comment-1" rowspan="1">add byte 3</td>
</tr>
<tr>
<td class="address-1"><span id="BE77"></span>BE77</td>
<td class="bytes">85 64</td>
<td class="instruction">STA $64</td>
<td class="comment-1" rowspan="1">save FAC1 mantissa3</td>
</tr>
<tr>
<td class="address-1"><span id="BE79"></span>BE79</td>
<td class="bytes">A5 63</td>
<td class="instruction">LDA $63</td>
<td class="comment-1" rowspan="1">get FAC1 mantissa 2</td>
</tr>
<tr>
<td class="address-1"><span id="BE7B"></span>BE7B</td>
<td class="bytes">79 17 BF</td>
<td class="instruction">ADC $BF17,Y</td>
<td class="comment-1" rowspan="1">add byte 2</td>
</tr>
<tr>
<td class="address-1"><span id="BE7E"></span>BE7E</td>
<td class="bytes">85 63</td>
<td class="instruction">STA $63</td>
<td class="comment-1" rowspan="1">save FAC1 mantissa2</td>
</tr>
<tr>
<td class="address-1"><span id="BE80"></span>BE80</td>
<td class="bytes">A5 62</td>
<td class="instruction">LDA $62</td>
<td class="comment-1" rowspan="1">get FAC1 mantissa 1</td>
</tr>
<tr>
<td class="address-1"><span id="BE82"></span>BE82</td>
<td class="bytes">79 16 BF</td>
<td class="instruction">ADC $BF16,Y</td>
<td class="comment-1" rowspan="1">add byte 1, most significant</td>
</tr>
<tr>
<td class="address-1"><span id="BE85"></span>BE85</td>
<td class="bytes">85 62</td>
<td class="instruction">STA $62</td>
<td class="comment-1" rowspan="1">save FAC1 mantissa1</td>
</tr>
<tr>
<td class="address-1"><span id="BE87"></span>BE87</td>
<td class="bytes">E8</td>
<td class="instruction">INX</td>
<td class="comment-1" rowspan="1">increment the digit, set the sign on the test sense bit</td>
</tr>
<tr>
<td class="address-1"><span id="BE88"></span>BE88</td>
<td class="bytes">B0 04</td>
<td class="instruction">BCS <a href="BDDD.html#BE8E">$BE8E</a></td>
<td class="comment-1" rowspan="1">if the carry is set go test if the result was positive</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="BE8A"></span>
<div class="comments">
<div class="paragraph">
else the result needs to be negative
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="BE8A"></span>BE8A</td>
<td class="bytes">10 DE</td>
<td class="instruction">BPL <a href="BDDD.html#BE6A">$BE6A</a></td>
<td class="comment-1" rowspan="1">not -ve so try again</td>
</tr>
<tr>
<td class="address-1"><span id="BE8C"></span>BE8C</td>
<td class="bytes">30 02</td>
<td class="instruction">BMI <a href="BDDD.html#BE90">$BE90</a></td>
<td class="comment-1" rowspan="1">else done so return the digit</td>
</tr>
<tr>
<td class="address-2"><span id="BE8E"></span>BE8E</td>
<td class="bytes">30 DA</td>
<td class="instruction">BMI <a href="BDDD.html#BE6A">$BE6A</a></td>
<td class="comment-1" rowspan="1">not +ve so try again</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="BE90"></span>
<div class="comments">
<div class="paragraph">
else done so return the digit
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="BE90"></span>BE90</td>
<td class="bytes">8A</td>
<td class="instruction">TXA</td>
<td class="comment-1" rowspan="1">copy the digit</td>
</tr>
<tr>
<td class="address-1"><span id="BE91"></span>BE91</td>
<td class="bytes">90 04</td>
<td class="instruction">BCC <a href="BDDD.html#BE97">$BE97</a></td>
<td class="comment-1" rowspan="1">if Cb=0 just use it</td>
</tr>
<tr>
<td class="address-1"><span id="BE93"></span>BE93</td>
<td class="bytes">49 FF</td>
<td class="instruction">EOR #$FF</td>
<td class="comment-1" rowspan="1">else make the 2's complement ..</td>
</tr>
<tr>
<td class="address-1"><span id="BE95"></span>BE95</td>
<td class="bytes">69 0A</td>
<td class="instruction">ADC #$0A</td>
<td class="comment-1" rowspan="1">.. and subtract it from 10</td>
</tr>
<tr>
<td class="address-2"><span id="BE97"></span>BE97</td>
<td class="bytes">69 2F</td>
<td class="instruction">ADC #$2F</td>
<td class="comment-1" rowspan="1">add "0"-1 to result</td>
</tr>
<tr>
<td class="address-1"><span id="BE99"></span>BE99</td>
<td class="bytes">C8</td>
<td class="instruction">INY</td>
<td class="comment-1" rowspan="1">increment ..</td>
</tr>
<tr>
<td class="address-1"><span id="BE9A"></span>BE9A</td>
<td class="bytes">C8</td>
<td class="instruction">INY</td>
<td class="comment-1" rowspan="1">.. index to ..</td>
</tr>
<tr>
<td class="address-1"><span id="BE9B"></span>BE9B</td>
<td class="bytes">C8</td>
<td class="instruction">INY</td>
<td class="comment-1" rowspan="1">.. next less ..</td>
</tr>
<tr>
<td class="address-1"><span id="BE9C"></span>BE9C</td>
<td class="bytes">C8</td>
<td class="instruction">INY</td>
<td class="comment-1" rowspan="1">.. power of ten</td>
</tr>
<tr>
<td class="address-1"><span id="BE9D"></span>BE9D</td>
<td class="bytes">84 47</td>
<td class="instruction">STY $47</td>
<td class="comment-1" rowspan="1">save current variable pointer low byte</td>
</tr>
<tr>
<td class="address-1"><span id="BE9F"></span>BE9F</td>
<td class="bytes">A4 71</td>
<td class="instruction">LDY $71</td>
<td class="comment-1" rowspan="1">get output string index</td>
</tr>
<tr>
<td class="address-1"><span id="BEA1"></span>BEA1</td>
<td class="bytes">C8</td>
<td class="instruction">INY</td>
<td class="comment-1" rowspan="1">increment output string index</td>
</tr>
<tr>
<td class="address-1"><span id="BEA2"></span>BEA2</td>
<td class="bytes">AA</td>
<td class="instruction">TAX</td>
<td class="comment-1" rowspan="1">copy character to <span class="register">X</span></td>
</tr>
<tr>
<td class="address-1"><span id="BEA3"></span>BEA3</td>
<td class="bytes">29 7F</td>
<td class="instruction">AND #%01111111</td>
<td class="comment-1" rowspan="1">mask out top bit</td>
</tr>
<tr>
<td class="address-1"><span id="BEA5"></span>BEA5</td>
<td class="bytes">99 FF 00</td>
<td class="instruction">STA $00FF,Y</td>
<td class="comment-1" rowspan="1">save to output string</td>
</tr>
<tr>
<td class="address-1"><span id="BEA8"></span>BEA8</td>
<td class="bytes">C6 5D</td>
<td class="instruction">DEC $5D</td>
<td class="comment-1" rowspan="1">decrement # of characters before the dp</td>
</tr>
<tr>
<td class="address-1"><span id="BEAA"></span>BEAA</td>
<td class="bytes">D0 06</td>
<td class="instruction">BNE <a href="BDDD.html#BEB2">$BEB2</a></td>
<td class="comment-1" rowspan="1">branch if still characters to do</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="BEAC"></span>
<div class="comments">
<div class="paragraph">
else output the point
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="BEAC"></span>BEAC</td>
<td class="bytes">A9 2E</td>
<td class="instruction">LDA #"."</td>
<td class="comment-1" rowspan="1">character "."</td>
</tr>
<tr>
<td class="address-1"><span id="BEAE"></span>BEAE</td>
<td class="bytes">C8</td>
<td class="instruction">INY</td>
<td class="comment-1" rowspan="1">increment output string index</td>
</tr>
<tr>
<td class="address-1"><span id="BEAF"></span>BEAF</td>
<td class="bytes">99 FF 00</td>
<td class="instruction">STA $00FF,Y</td>
<td class="comment-1" rowspan="1">save to output string</td>
</tr>
<tr>
<td class="address-2"><span id="BEB2"></span>BEB2</td>
<td class="bytes">84 71</td>
<td class="instruction">STY $71</td>
<td class="comment-1" rowspan="1">save output string index</td>
</tr>
<tr>
<td class="address-1"><span id="BEB4"></span>BEB4</td>
<td class="bytes">A4 47</td>
<td class="instruction">LDY $47</td>
<td class="comment-1" rowspan="1">get current variable pointer low byte</td>
</tr>
<tr>
<td class="address-1"><span id="BEB6"></span>BEB6</td>
<td class="bytes">8A</td>
<td class="instruction">TXA</td>
<td class="comment-1" rowspan="1">get character back</td>
</tr>
<tr>
<td class="address-1"><span id="BEB7"></span>BEB7</td>
<td class="bytes">49 FF</td>
<td class="instruction">EOR #$FF</td>
<td class="comment-1" rowspan="1">toggle the test sense bit</td>
</tr>
<tr>
<td class="address-1"><span id="BEB9"></span>BEB9</td>
<td class="bytes">29 80</td>
<td class="instruction">AND #$80</td>
<td class="comment-1" rowspan="1">clear the digit</td>
</tr>
<tr>
<td class="address-1"><span id="BEBB"></span>BEBB</td>
<td class="bytes">AA</td>
<td class="instruction">TAX</td>
<td class="comment-1" rowspan="1">copy it to the new digit</td>
</tr>
<tr>
<td class="address-1"><span id="BEBC"></span>BEBC</td>
<td class="bytes">C0 24</td>
<td class="instruction">CPY #$24</td>
<td class="comment-1" rowspan="1">compare the table index with the max for decimal numbers</td>
</tr>
<tr>
<td class="address-1"><span id="BEBE"></span>BEBE</td>
<td class="bytes">F0 04</td>
<td class="instruction">BEQ <a href="BDDD.html#BEC4">$BEC4</a></td>
<td class="comment-1" rowspan="1">if at the max exit the digit loop</td>
</tr>
<tr>
<td class="address-1"><span id="BEC0"></span>BEC0</td>
<td class="bytes">C0 3C</td>
<td class="instruction">CPY #$3C</td>
<td class="comment-1" rowspan="1">compare the table index with the max for time</td>
</tr>
<tr>
<td class="address-1"><span id="BEC2"></span>BEC2</td>
<td class="bytes">D0 A6</td>
<td class="instruction">BNE <a href="BDDD.html#BE6A">$BE6A</a></td>
<td class="comment-1" rowspan="1">loop if not at the max</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="BEC4"></span>
<div class="comments">
<div class="paragraph">
now remove trailing zeroes
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="BEC4"></span>BEC4</td>
<td class="bytes">A4 71</td>
<td class="instruction">LDY $71</td>
<td class="comment-1" rowspan="1">restore the output string index</td>
</tr>
<tr>
<td class="address-2"><span id="BEC6"></span>BEC6</td>
<td class="bytes">B9 FF 00</td>
<td class="instruction">LDA $00FF,Y</td>
<td class="comment-1" rowspan="1">get character from output string</td>
</tr>
<tr>
<td class="address-1"><span id="BEC9"></span>BEC9</td>
<td class="bytes">88</td>
<td class="instruction">DEY</td>
<td class="comment-1" rowspan="1">decrement output string index</td>
</tr>
<tr>
<td class="address-1"><span id="BECA"></span>BECA</td>
<td class="bytes">C9 30</td>
<td class="instruction">CMP #"0"</td>
<td class="comment-1" rowspan="1">compare with "0"</td>
</tr>
<tr>
<td class="address-1"><span id="BECC"></span>BECC</td>
<td class="bytes">F0 F8</td>
<td class="instruction">BEQ <a href="BDDD.html#BEC6">$BEC6</a></td>
<td class="comment-1" rowspan="1">loop until non "0" character found</td>
</tr>
<tr>
<td class="address-1"><span id="BECE"></span>BECE</td>
<td class="bytes">C9 2E</td>
<td class="instruction">CMP #"."</td>
<td class="comment-1" rowspan="1">compare with "."</td>
</tr>
<tr>
<td class="address-1"><span id="BED0"></span>BED0</td>
<td class="bytes">F0 01</td>
<td class="instruction">BEQ <a href="BDDD.html#BED3">$BED3</a></td>
<td class="comment-1" rowspan="1">branch if was dp</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="BED2"></span>
<div class="comments">
<div class="paragraph">
restore last character
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="BED2"></span>BED2</td>
<td class="bytes">C8</td>
<td class="instruction">INY</td>
<td class="comment-1" rowspan="1">increment output string index</td>
</tr>
<tr>
<td class="address-2"><span id="BED3"></span>BED3</td>
<td class="bytes">A9 2B</td>
<td class="instruction">LDA #"+"</td>
<td class="comment-1" rowspan="1">character "+"</td>
</tr>
<tr>
<td class="address-1"><span id="BED5"></span>BED5</td>
<td class="bytes">A6 5E</td>
<td class="instruction">LDX $5E</td>
<td class="comment-1" rowspan="1">get exponent count</td>
</tr>
<tr>
<td class="address-1"><span id="BED7"></span>BED7</td>
<td class="bytes">F0 2E</td>
<td class="instruction">BEQ <a href="BDDD.html#BF07">$BF07</a></td>
<td class="comment-1" rowspan="1">if zero go set null terminator and exit</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="BED9"></span>
<div class="comments">
<div class="paragraph">
exponent isn't zero so write exponent
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="BED9"></span>BED9</td>
<td class="bytes">10 08</td>
<td class="instruction">BPL <a href="BDDD.html#BEE3">$BEE3</a></td>
<td class="comment-1" rowspan="1">branch if exponent count +ve</td>
</tr>
<tr>
<td class="address-1"><span id="BEDB"></span>BEDB</td>
<td class="bytes">A9 00</td>
<td class="instruction">LDA #$00</td>
<td class="comment-1" rowspan="1">clear <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="BEDD"></span>BEDD</td>
<td class="bytes">38</td>
<td class="instruction">SEC</td>
<td class="comment-1" rowspan="1">set carry for subtract</td>
</tr>
<tr>
<td class="address-1"><span id="BEDE"></span>BEDE</td>
<td class="bytes">E5 5E</td>
<td class="instruction">SBC $5E</td>
<td class="comment-1" rowspan="1">subtract exponent count adjust (convert -ve to +ve)</td>
</tr>
<tr>
<td class="address-1"><span id="BEE0"></span>BEE0</td>
<td class="bytes">AA</td>
<td class="instruction">TAX</td>
<td class="comment-1" rowspan="1">copy exponent count to <span class="register">X</span></td>
</tr>
<tr>
<td class="address-1"><span id="BEE1"></span>BEE1</td>
<td class="bytes">A9 2D</td>
<td class="instruction">LDA #"-"</td>
<td class="comment-1" rowspan="1">character "-"</td>
</tr>
<tr>
<td class="address-2"><span id="BEE3"></span>BEE3</td>
<td class="bytes">99 01 01</td>
<td class="instruction">STA $0101,Y</td>
<td class="comment-1" rowspan="1">save to output string</td>
</tr>
<tr>
<td class="address-1"><span id="BEE6"></span>BEE6</td>
<td class="bytes">A9 45</td>
<td class="instruction">LDA #"E"</td>
<td class="comment-1" rowspan="1">character "E"</td>
</tr>
<tr>
<td class="address-1"><span id="BEE8"></span>BEE8</td>
<td class="bytes">99 00 01</td>
<td class="instruction">STA $0100,Y</td>
<td class="comment-1" rowspan="1">save exponent sign to output string</td>
</tr>
<tr>
<td class="address-1"><span id="BEEB"></span>BEEB</td>
<td class="bytes">8A</td>
<td class="instruction">TXA</td>
<td class="comment-1" rowspan="1">get exponent count back</td>
</tr>
<tr>
<td class="address-1"><span id="BEEC"></span>BEEC</td>
<td class="bytes">A2 2F</td>
<td class="instruction">LDX #$2F</td>
<td class="comment-1" rowspan="1">one less than "0" character</td>
</tr>
<tr>
<td class="address-1"><span id="BEEE"></span>BEEE</td>
<td class="bytes">38</td>
<td class="instruction">SEC</td>
<td class="comment-1" rowspan="1">set carry for subtract</td>
</tr>
<tr>
<td class="address-2"><span id="BEEF"></span>BEEF</td>
<td class="bytes">E8</td>
<td class="instruction">INX</td>
<td class="comment-1" rowspan="1">increment 10's character</td>
</tr>
<tr>
<td class="address-1"><span id="BEF0"></span>BEF0</td>
<td class="bytes">E9 0A</td>
<td class="instruction">SBC #$0A</td>
<td class="comment-1" rowspan="1">subtract 10 from exponent count</td>
</tr>
<tr>
<td class="address-1"><span id="BEF2"></span>BEF2</td>
<td class="bytes">B0 FB</td>
<td class="instruction">BCS <a href="BDDD.html#BEEF">$BEEF</a></td>
<td class="comment-1" rowspan="1">loop while still &gt;= 0</td>
</tr>
<tr>
<td class="address-1"><span id="BEF4"></span>BEF4</td>
<td class="bytes">69 3A</td>
<td class="instruction">ADC #":"</td>
<td class="comment-1" rowspan="1">add character ":" ($30+$0A, result is 10 less that value)</td>
</tr>
<tr>
<td class="address-1"><span id="BEF6"></span>BEF6</td>
<td class="bytes">99 03 01</td>
<td class="instruction">STA $0103,Y</td>
<td class="comment-1" rowspan="1">save to output string</td>
</tr>
<tr>
<td class="address-1"><span id="BEF9"></span>BEF9</td>
<td class="bytes">8A</td>
<td class="instruction">TXA</td>
<td class="comment-1" rowspan="1">copy 10's character</td>
</tr>
<tr>
<td class="address-1"><span id="BEFA"></span>BEFA</td>
<td class="bytes">99 02 01</td>
<td class="instruction">STA $0102,Y</td>
<td class="comment-1" rowspan="1">save to output string</td>
</tr>
<tr>
<td class="address-1"><span id="BEFD"></span>BEFD</td>
<td class="bytes">A9 00</td>
<td class="instruction">LDA #$00</td>
<td class="comment-1" rowspan="1">set null terminator</td>
</tr>
<tr>
<td class="address-1"><span id="BEFF"></span>BEFF</td>
<td class="bytes">99 04 01</td>
<td class="instruction">STA $0104,Y</td>
<td class="comment-1" rowspan="1">save to output string</td>
</tr>
<tr>
<td class="address-1"><span id="BF02"></span>BF02</td>
<td class="bytes">F0 08</td>
<td class="instruction">BEQ <a href="BDDD.html#BF0C">$BF0C</a></td>
<td class="comment-1" rowspan="1">go set string pointer (<span class="register">AY</span>) and exit, branch always</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="BF04"></span>
<div class="comments">
<div class="paragraph">
save last character, [EOT] and exit
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="BF04"></span>BF04</td>
<td class="bytes">99 FF 00</td>
<td class="instruction">STA $00FF,Y</td>
<td class="comment-1" rowspan="1">save last character to output string</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="BF07"></span>
<div class="comments">
<div class="paragraph">
set null terminator and exit
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="BF07"></span>BF07</td>
<td class="bytes">A9 00</td>
<td class="instruction">LDA #$00</td>
<td class="comment-1" rowspan="1">set null terminator</td>
</tr>
<tr>
<td class="address-1"><span id="BF09"></span>BF09</td>
<td class="bytes">99 00 01</td>
<td class="instruction">STA $0100,Y</td>
<td class="comment-1" rowspan="1">save after last character</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="BF0C"></span>
<div class="comments">
<div class="paragraph">
set string pointer (<span class="register">AY</span>) and exit
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="BF0C"></span>BF0C</td>
<td class="bytes">A9 00</td>
<td class="instruction">LDA #$00</td>
<td class="comment-1" rowspan="1">set result string pointer low byte</td>
</tr>
<tr>
<td class="address-1"><span id="BF0E"></span>BF0E</td>
<td class="bytes">A0 01</td>
<td class="instruction">LDY #$01</td>
<td class="comment-1" rowspan="1">set result string pointer high byte</td>
</tr>
<tr>
<td class="address-1"><span id="BF10"></span>BF10</td>
<td class="bytes">60</td>
<td class="instruction">RTS</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="BDCD.html">BDCD</a>
</td>
<td class="up">Up: <a href="../maps/all.html#BDDD">Map</a></td>
<td class="next">
Next: <a href="BF11.html">BF11</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&#169; 2012 Lee Davison.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.0 and <a href="https://github.com/skoolkid/sk6502">sk6502</a>.</div>
</footer>
</body>
</html>