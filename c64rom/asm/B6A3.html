<!DOCTYPE html>
<html>
<head>
<title>C64 ROM: Routine at B6A3</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html">C64 ROM</a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="B67A.html">B67A</a>
</td>
<td class="up">Up: <a href="../maps/all.html#B6A3">Map</a></td>
<td class="next">
Next: <a href="B6DB.html">B6DB</a>
</td>
</tr>
</table>
<div class="description">B6A3: evaluate string</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="B782.html">B782</a> and <a href="E257.html">E257</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="B6A3"></span>B6A3</td>
<td class="bytes">20 8F AD</td>
<td class="instruction">JSR <a href="AD8A.html#AD8F">$AD8F</a></td>
<td class="comment-1" rowspan="1">check if source is string, else do type mismatch</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="B6A6"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routines at <a href="A9A5.html">A9A5</a>, <a href="AB21.html">AB21</a>, <a href="B016.html">B016</a> and <a href="B37D.html">B37D</a>.
</div>
<div class="paragraph">
pop string off descriptor stack, or from top of string space. returns with <span class="register">A</span> = length, <span class="register">X</span> = pointer low byte, <span class="register">Y</span> = pointer high byte
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="B6A6"></span>B6A6</td>
<td class="bytes">A5 64</td>
<td class="instruction">LDA $64</td>
<td class="comment-1" rowspan="1">get descriptor pointer low byte</td>
</tr>
<tr>
<td class="address-1"><span id="B6A8"></span>B6A8</td>
<td class="bytes">A4 65</td>
<td class="instruction">LDY $65</td>
<td class="comment-1" rowspan="1">get descriptor pointer high byte</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="B6AA"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routines at <a href="B016.html">B016</a>, <a href="B63D.html">B63D</a> and <a href="B700.html">B700</a>.
</div>
<div class="paragraph">
pop (<span class="register">YA</span>) descriptor off stack or from top of string space. returns with <span class="register">A</span> = length, <span class="register">X</span> = pointer low byte, <span class="register">Y</span> = pointer high byte
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="B6AA"></span>B6AA</td>
<td class="bytes">85 22</td>
<td class="instruction">STA $22</td>
<td class="comment-1" rowspan="1">save string pointer low byte</td>
</tr>
<tr>
<td class="address-1"><span id="B6AC"></span>B6AC</td>
<td class="bytes">84 23</td>
<td class="instruction">STY $23</td>
<td class="comment-1" rowspan="1">save string pointer high byte</td>
</tr>
<tr>
<td class="address-1"><span id="B6AE"></span>B6AE</td>
<td class="bytes">20 DB B6</td>
<td class="instruction">JSR <a href="B6DB.html">$B6DB</a></td>
<td class="comment-1" rowspan="1">clean descriptor stack, <span class="register">YA</span> = pointer</td>
</tr>
<tr>
<td class="address-1"><span id="B6B1"></span>B6B1</td>
<td class="bytes">08</td>
<td class="instruction">PHP</td>
<td class="comment-1" rowspan="1">save status flags</td>
</tr>
<tr>
<td class="address-1"><span id="B6B2"></span>B6B2</td>
<td class="bytes">A0 00</td>
<td class="instruction">LDY #$00</td>
<td class="comment-1" rowspan="1">clear index</td>
</tr>
<tr>
<td class="address-1"><span id="B6B4"></span>B6B4</td>
<td class="bytes">B1 22</td>
<td class="instruction">LDA ($22),Y</td>
<td class="comment-1" rowspan="1">get length from string descriptor</td>
</tr>
<tr>
<td class="address-1"><span id="B6B6"></span>B6B6</td>
<td class="bytes">48</td>
<td class="instruction">PHA</td>
<td class="comment-1" rowspan="1">put on stack</td>
</tr>
<tr>
<td class="address-1"><span id="B6B7"></span>B6B7</td>
<td class="bytes">C8</td>
<td class="instruction">INY</td>
<td class="comment-1" rowspan="1">increment index</td>
</tr>
<tr>
<td class="address-1"><span id="B6B8"></span>B6B8</td>
<td class="bytes">B1 22</td>
<td class="instruction">LDA ($22),Y</td>
<td class="comment-1" rowspan="1">get string pointer low byte from descriptor</td>
</tr>
<tr>
<td class="address-1"><span id="B6BA"></span>B6BA</td>
<td class="bytes">AA</td>
<td class="instruction">TAX</td>
<td class="comment-1" rowspan="1">copy to <span class="register">X</span></td>
</tr>
<tr>
<td class="address-1"><span id="B6BB"></span>B6BB</td>
<td class="bytes">C8</td>
<td class="instruction">INY</td>
<td class="comment-1" rowspan="1">increment index</td>
</tr>
<tr>
<td class="address-1"><span id="B6BC"></span>B6BC</td>
<td class="bytes">B1 22</td>
<td class="instruction">LDA ($22),Y</td>
<td class="comment-1" rowspan="1">get string pointer high byte from descriptor</td>
</tr>
<tr>
<td class="address-1"><span id="B6BE"></span>B6BE</td>
<td class="bytes">A8</td>
<td class="instruction">TAY</td>
<td class="comment-1" rowspan="1">copy to <span class="register">Y</span></td>
</tr>
<tr>
<td class="address-1"><span id="B6BF"></span>B6BF</td>
<td class="bytes">68</td>
<td class="instruction">PLA</td>
<td class="comment-1" rowspan="1">get string length back</td>
</tr>
<tr>
<td class="address-1"><span id="B6C0"></span>B6C0</td>
<td class="bytes">28</td>
<td class="instruction">PLP</td>
<td class="comment-1" rowspan="1">restore status</td>
</tr>
<tr>
<td class="address-1"><span id="B6C1"></span>B6C1</td>
<td class="bytes">D0 13</td>
<td class="instruction">BNE <a href="B6A3.html#B6D6">$B6D6</a></td>
<td class="comment-1" rowspan="1">branch if pointer &lt;&gt; last_sl,last_sh</td>
</tr>
<tr>
<td class="address-1"><span id="B6C3"></span>B6C3</td>
<td class="bytes">C4 34</td>
<td class="instruction">CPY $34</td>
<td class="comment-1" rowspan="1">compare with bottom of string space high byte</td>
</tr>
<tr>
<td class="address-1"><span id="B6C5"></span>B6C5</td>
<td class="bytes">D0 0F</td>
<td class="instruction">BNE <a href="B6A3.html#B6D6">$B6D6</a></td>
<td class="comment-1" rowspan="1">branch if &lt;&gt;</td>
</tr>
<tr>
<td class="address-1"><span id="B6C7"></span>B6C7</td>
<td class="bytes">E4 33</td>
<td class="instruction">CPX $33</td>
<td class="comment-1" rowspan="1">else compare with bottom of string space low byte</td>
</tr>
<tr>
<td class="address-1"><span id="B6C9"></span>B6C9</td>
<td class="bytes">D0 0B</td>
<td class="instruction">BNE <a href="B6A3.html#B6D6">$B6D6</a></td>
<td class="comment-1" rowspan="1">branch if &lt;&gt;</td>
</tr>
<tr>
<td class="address-1"><span id="B6CB"></span>B6CB</td>
<td class="bytes">48</td>
<td class="instruction">PHA</td>
<td class="comment-1" rowspan="1">save string length</td>
</tr>
<tr>
<td class="address-1"><span id="B6CC"></span>B6CC</td>
<td class="bytes">18</td>
<td class="instruction">CLC</td>
<td class="comment-1" rowspan="1">clear carry for add</td>
</tr>
<tr>
<td class="address-1"><span id="B6CD"></span>B6CD</td>
<td class="bytes">65 33</td>
<td class="instruction">ADC $33</td>
<td class="comment-1" rowspan="1">add bottom of string space low byte</td>
</tr>
<tr>
<td class="address-1"><span id="B6CF"></span>B6CF</td>
<td class="bytes">85 33</td>
<td class="instruction">STA $33</td>
<td class="comment-1" rowspan="1">set bottom of string space low byte</td>
</tr>
<tr>
<td class="address-1"><span id="B6D1"></span>B6D1</td>
<td class="bytes">90 02</td>
<td class="instruction">BCC <a href="B6A3.html#B6D5">$B6D5</a></td>
<td class="comment-1" rowspan="1">skip increment if no overflow</td>
</tr>
<tr>
<td class="address-1"><span id="B6D3"></span>B6D3</td>
<td class="bytes">E6 34</td>
<td class="instruction">INC $34</td>
<td class="comment-1" rowspan="1">increment bottom of string space high byte</td>
</tr>
<tr>
<td class="address-2"><span id="B6D5"></span>B6D5</td>
<td class="bytes">68</td>
<td class="instruction">PLA</td>
<td class="comment-1" rowspan="1">restore string length</td>
</tr>
<tr>
<td class="address-2"><span id="B6D6"></span>B6D6</td>
<td class="bytes">86 22</td>
<td class="instruction">STX $22</td>
<td class="comment-1" rowspan="1">save string pointer low byte</td>
</tr>
<tr>
<td class="address-1"><span id="B6D8"></span>B6D8</td>
<td class="bytes">84 23</td>
<td class="instruction">STY $23</td>
<td class="comment-1" rowspan="1">save string pointer high byte</td>
</tr>
<tr>
<td class="address-1"><span id="B6DA"></span>B6DA</td>
<td class="bytes">60</td>
<td class="instruction">RTS</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="B67A.html">B67A</a>
</td>
<td class="up">Up: <a href="../maps/all.html#B6A3">Map</a></td>
<td class="next">
Next: <a href="B6DB.html">B6DB</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&#169; 2012 Lee Davison.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.0 and <a href="https://github.com/skoolkid/sk6502">sk6502</a>.</div>
</footer>
</body>
</html>