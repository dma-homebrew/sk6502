<!DOCTYPE html>
<html>
<head>
<title>C64 ROM: Routine at BA28</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html">C64 ROM</a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="B9EA.html">B9EA</a>
</td>
<td class="up">Up: <a href="../maps/all.html#BA28">Map</a></td>
<td class="next">
Next: <a href="BA8C.html">BA8C</a>
</td>
</tr>
</table>
<div class="description">BA28: do convert <span class="register">AY</span>, FCA1*(<span class="register">AY</span>)</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="BDDD.html">BDDD</a>, <a href="BF7B.html">BF7B</a>, <a href="BFED.html">BFED</a>, <a href="E043.html">E043</a>, <a href="E059.html">E059</a> and <a href="E097.html">E097</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="BA28"></span>BA28</td>
<td class="bytes">20 8C BA</td>
<td class="instruction">JSR <a href="BA8C.html">$BA8C</a></td>
<td class="comment-1" rowspan="1">unpack memory (<span class="register">AY</span>) into FAC2</td>
</tr>
<tr>
<td class="address-1"><span id="BA2B"></span>BA2B</td>
<td class="bytes">D0 03</td>
<td class="instruction">BNE <a href="BA28.html#BA30">$BA30</a></td>
<td class="comment-1" rowspan="1">multiply FAC1 by FAC2 ??</td>
</tr>
<tr>
<td class="address-1"><span id="BA2D"></span>BA2D</td>
<td class="bytes">4C 8B BA</td>
<td class="instruction">JMP <a href="BA28.html#BA8B">$BA8B</a></td>
<td class="comment-1" rowspan="1">exit if zero</td>
</tr>
<tr>
<td class="address-2"><span id="BA30"></span>BA30</td>
<td class="bytes">20 B7 BA</td>
<td class="instruction">JSR <a href="BAB7.html">$BAB7</a></td>
<td class="comment-1" rowspan="1">test and adjust accumulators</td>
</tr>
<tr>
<td class="address-1"><span id="BA33"></span>BA33</td>
<td class="bytes">A9 00</td>
<td class="instruction">LDA #$00</td>
<td class="comment-1" rowspan="1">clear <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="BA35"></span>BA35</td>
<td class="bytes">85 26</td>
<td class="instruction">STA $26</td>
<td class="comment-1" rowspan="1">clear temp mantissa 1</td>
</tr>
<tr>
<td class="address-1"><span id="BA37"></span>BA37</td>
<td class="bytes">85 27</td>
<td class="instruction">STA $27</td>
<td class="comment-1" rowspan="1">clear temp mantissa 2</td>
</tr>
<tr>
<td class="address-1"><span id="BA39"></span>BA39</td>
<td class="bytes">85 28</td>
<td class="instruction">STA $28</td>
<td class="comment-1" rowspan="1">clear temp mantissa 3</td>
</tr>
<tr>
<td class="address-1"><span id="BA3B"></span>BA3B</td>
<td class="bytes">85 29</td>
<td class="instruction">STA $29</td>
<td class="comment-1" rowspan="1">clear temp mantissa 4</td>
</tr>
<tr>
<td class="address-1"><span id="BA3D"></span>BA3D</td>
<td class="bytes">A5 70</td>
<td class="instruction">LDA $70</td>
<td class="comment-1" rowspan="1">get FAC1 rounding byte</td>
</tr>
<tr>
<td class="address-1"><span id="BA3F"></span>BA3F</td>
<td class="bytes">20 59 BA</td>
<td class="instruction">JSR <a href="BA28.html#BA59">$BA59</a></td>
<td class="comment-1" rowspan="1">go do shift/add FAC2</td>
</tr>
<tr>
<td class="address-1"><span id="BA42"></span>BA42</td>
<td class="bytes">A5 65</td>
<td class="instruction">LDA $65</td>
<td class="comment-1" rowspan="1">get FAC1 mantissa 4</td>
</tr>
<tr>
<td class="address-1"><span id="BA44"></span>BA44</td>
<td class="bytes">20 59 BA</td>
<td class="instruction">JSR <a href="BA28.html#BA59">$BA59</a></td>
<td class="comment-1" rowspan="1">go do shift/add FAC2</td>
</tr>
<tr>
<td class="address-1"><span id="BA47"></span>BA47</td>
<td class="bytes">A5 64</td>
<td class="instruction">LDA $64</td>
<td class="comment-1" rowspan="1">get FAC1 mantissa 3</td>
</tr>
<tr>
<td class="address-1"><span id="BA49"></span>BA49</td>
<td class="bytes">20 59 BA</td>
<td class="instruction">JSR <a href="BA28.html#BA59">$BA59</a></td>
<td class="comment-1" rowspan="1">go do shift/add FAC2</td>
</tr>
<tr>
<td class="address-1"><span id="BA4C"></span>BA4C</td>
<td class="bytes">A5 63</td>
<td class="instruction">LDA $63</td>
<td class="comment-1" rowspan="1">get FAC1 mantissa 2</td>
</tr>
<tr>
<td class="address-1"><span id="BA4E"></span>BA4E</td>
<td class="bytes">20 59 BA</td>
<td class="instruction">JSR <a href="BA28.html#BA59">$BA59</a></td>
<td class="comment-1" rowspan="1">go do shift/add FAC2</td>
</tr>
<tr>
<td class="address-1"><span id="BA51"></span>BA51</td>
<td class="bytes">A5 62</td>
<td class="instruction">LDA $62</td>
<td class="comment-1" rowspan="1">get FAC1 mantissa 1</td>
</tr>
<tr>
<td class="address-1"><span id="BA53"></span>BA53</td>
<td class="bytes">20 5E BA</td>
<td class="instruction">JSR <a href="BA28.html#BA5E">$BA5E</a></td>
<td class="comment-1" rowspan="1">go do shift/add FAC2</td>
</tr>
<tr>
<td class="address-1"><span id="BA56"></span>BA56</td>
<td class="bytes">4C 8F BB</td>
<td class="instruction">JMP <a href="BB0F.html#BB8F">$BB8F</a></td>
<td class="comment-1" rowspan="1">copy temp to FAC1, normalise and return</td>
</tr>
<tr>
<td class="address-2"><span id="BA59"></span>BA59</td>
<td class="bytes">D0 03</td>
<td class="instruction">BNE <a href="BA28.html#BA5E">$BA5E</a></td>
<td class="comment-1" rowspan="1">branch if byte &lt;&gt; zero</td>
</tr>
<tr>
<td class="address-1"><span id="BA5B"></span>BA5B</td>
<td class="bytes">4C 83 B9</td>
<td class="instruction">JMP <a href="B983.html">$B983</a></td>
<td class="comment-1" rowspan="1">shift FCAtemp &lt;&lt; <span class="register">A</span>+8 times</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="BA5E"></span>
<div class="comments">
<div class="paragraph">
else do shift and add
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="BA5E"></span>BA5E</td>
<td class="bytes">4A</td>
<td class="instruction">LSR A</td>
<td class="comment-1" rowspan="1">shift byte</td>
</tr>
<tr>
<td class="address-1"><span id="BA5F"></span>BA5F</td>
<td class="bytes">09 80</td>
<td class="instruction">ORA #$80</td>
<td class="comment-1" rowspan="1">set top bit (mark for 8 times)</td>
</tr>
<tr>
<td class="address-2"><span id="BA61"></span>BA61</td>
<td class="bytes">A8</td>
<td class="instruction">TAY</td>
<td class="comment-1" rowspan="1">copy result</td>
</tr>
<tr>
<td class="address-1"><span id="BA62"></span>BA62</td>
<td class="bytes">90 19</td>
<td class="instruction">BCC <a href="BA28.html#BA7D">$BA7D</a></td>
<td class="comment-1" rowspan="1">skip next if bit was zero</td>
</tr>
<tr>
<td class="address-1"><span id="BA64"></span>BA64</td>
<td class="bytes">18</td>
<td class="instruction">CLC</td>
<td class="comment-1" rowspan="1">clear carry for add</td>
</tr>
<tr>
<td class="address-1"><span id="BA65"></span>BA65</td>
<td class="bytes">A5 29</td>
<td class="instruction">LDA $29</td>
<td class="comment-1" rowspan="1">get temp mantissa 4</td>
</tr>
<tr>
<td class="address-1"><span id="BA67"></span>BA67</td>
<td class="bytes">65 6D</td>
<td class="instruction">ADC $6D</td>
<td class="comment-1" rowspan="1">add FAC2 mantissa 4</td>
</tr>
<tr>
<td class="address-1"><span id="BA69"></span>BA69</td>
<td class="bytes">85 29</td>
<td class="instruction">STA $29</td>
<td class="comment-1" rowspan="1">save temp mantissa 4</td>
</tr>
<tr>
<td class="address-1"><span id="BA6B"></span>BA6B</td>
<td class="bytes">A5 28</td>
<td class="instruction">LDA $28</td>
<td class="comment-1" rowspan="1">get temp mantissa 3</td>
</tr>
<tr>
<td class="address-1"><span id="BA6D"></span>BA6D</td>
<td class="bytes">65 6C</td>
<td class="instruction">ADC $6C</td>
<td class="comment-1" rowspan="1">add FAC2 mantissa 3</td>
</tr>
<tr>
<td class="address-1"><span id="BA6F"></span>BA6F</td>
<td class="bytes">85 28</td>
<td class="instruction">STA $28</td>
<td class="comment-1" rowspan="1">save temp mantissa 3</td>
</tr>
<tr>
<td class="address-1"><span id="BA71"></span>BA71</td>
<td class="bytes">A5 27</td>
<td class="instruction">LDA $27</td>
<td class="comment-1" rowspan="1">get temp mantissa 2</td>
</tr>
<tr>
<td class="address-1"><span id="BA73"></span>BA73</td>
<td class="bytes">65 6B</td>
<td class="instruction">ADC $6B</td>
<td class="comment-1" rowspan="1">add FAC2 mantissa 2</td>
</tr>
<tr>
<td class="address-1"><span id="BA75"></span>BA75</td>
<td class="bytes">85 27</td>
<td class="instruction">STA $27</td>
<td class="comment-1" rowspan="1">save temp mantissa 2</td>
</tr>
<tr>
<td class="address-1"><span id="BA77"></span>BA77</td>
<td class="bytes">A5 26</td>
<td class="instruction">LDA $26</td>
<td class="comment-1" rowspan="1">get temp mantissa 1</td>
</tr>
<tr>
<td class="address-1"><span id="BA79"></span>BA79</td>
<td class="bytes">65 6A</td>
<td class="instruction">ADC $6A</td>
<td class="comment-1" rowspan="1">add FAC2 mantissa 1</td>
</tr>
<tr>
<td class="address-1"><span id="BA7B"></span>BA7B</td>
<td class="bytes">85 26</td>
<td class="instruction">STA $26</td>
<td class="comment-1" rowspan="1">save temp mantissa 1</td>
</tr>
<tr>
<td class="address-2"><span id="BA7D"></span>BA7D</td>
<td class="bytes">66 26</td>
<td class="instruction">ROR $26</td>
<td class="comment-1" rowspan="1">shift temp mantissa 1</td>
</tr>
<tr>
<td class="address-1"><span id="BA7F"></span>BA7F</td>
<td class="bytes">66 27</td>
<td class="instruction">ROR $27</td>
<td class="comment-1" rowspan="1">shift temp mantissa 2</td>
</tr>
<tr>
<td class="address-1"><span id="BA81"></span>BA81</td>
<td class="bytes">66 28</td>
<td class="instruction">ROR $28</td>
<td class="comment-1" rowspan="1">shift temp mantissa 3</td>
</tr>
<tr>
<td class="address-1"><span id="BA83"></span>BA83</td>
<td class="bytes">66 29</td>
<td class="instruction">ROR $29</td>
<td class="comment-1" rowspan="1">shift temp mantissa 4</td>
</tr>
<tr>
<td class="address-1"><span id="BA85"></span>BA85</td>
<td class="bytes">66 70</td>
<td class="instruction">ROR $70</td>
<td class="comment-1" rowspan="1">shift temp rounding byte</td>
</tr>
<tr>
<td class="address-1"><span id="BA87"></span>BA87</td>
<td class="bytes">98</td>
<td class="instruction">TYA</td>
<td class="comment-1" rowspan="1">get byte back</td>
</tr>
<tr>
<td class="address-1"><span id="BA88"></span>BA88</td>
<td class="bytes">4A</td>
<td class="instruction">LSR A</td>
<td class="comment-1" rowspan="1">shift byte</td>
</tr>
<tr>
<td class="address-1"><span id="BA89"></span>BA89</td>
<td class="bytes">D0 D6</td>
<td class="instruction">BNE <a href="BA28.html#BA61">$BA61</a></td>
<td class="comment-1" rowspan="1">loop if all bits not done</td>
</tr>
<tr>
<td class="address-2"><span id="BA8B"></span>BA8B</td>
<td class="bytes">60</td>
<td class="instruction">RTS</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="B9EA.html">B9EA</a>
</td>
<td class="up">Up: <a href="../maps/all.html#BA28">Map</a></td>
<td class="next">
Next: <a href="BA8C.html">BA8C</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&#169; 2012 Lee Davison.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.0 and <a href="https://github.com/skoolkid/sk6502">sk6502</a>.</div>
</footer>
</body>
</html>