<!DOCTYPE html>
<html>
<head>
<title>C64 ROM: Routine at AD9E</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html">C64 ROM</a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="AD8A.html">AD8A</a>
</td>
<td class="up">Up: <a href="../maps/all.html#AD9E">Map</a></td>
<td class="next">
Next: <a href="AE20.html">AE20</a>
</td>
</tr>
</table>
<div class="description">AD9E: evaluate expression</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="A928.html">A928</a>, <a href="A9A5.html">A9A5</a>, <a href="AAA0.html">AAA0</a>, <a href="AD8A.html">AD8A</a>, <a href="AE86.html">AE86</a>, <a href="AFA7.html">AFA7</a>, <a href="B1B2.html">B1B2</a> and <a href="E257.html">E257</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="AD9E"></span>AD9E</td>
<td class="bytes">A6 7A</td>
<td class="instruction">LDX $7A</td>
<td class="comment-1" rowspan="1">get BASIC execute pointer low byte</td>
</tr>
<tr>
<td class="address-1"><span id="ADA0"></span>ADA0</td>
<td class="bytes">D0 02</td>
<td class="instruction">BNE <a href="AD9E.html#ADA4">$ADA4</a></td>
<td class="comment-1" rowspan="1">skip next if not zero</td>
</tr>
<tr>
<td class="address-1"><span id="ADA2"></span>ADA2</td>
<td class="bytes">C6 7B</td>
<td class="instruction">DEC $7B</td>
<td class="comment-1" rowspan="1">else decrement BASIC execute pointer high byte</td>
</tr>
<tr>
<td class="address-2"><span id="ADA4"></span>ADA4</td>
<td class="bytes">C6 7A</td>
<td class="instruction">DEC $7A</td>
<td class="comment-1" rowspan="1">decrement BASIC execute pointer low byte</td>
</tr>
<tr>
<td class="address-1"><span id="ADA6"></span>ADA6</td>
<td class="bytes">A2 00</td>
<td class="instruction">LDX #$00</td>
<td class="comment-1" rowspan="1">set null precedence, flag done</td>
</tr>
<tr>
<td class="address-1"><span id="ADA8"></span>ADA8</td>
<td class="bytes"></td>
<td class="instruction">.BYTE $24</td>
<td class="comment-1" rowspan="1">makes next line BIT $48</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="ADA9"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="AE20.html">AE20</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="ADA9"></span>ADA9</td>
<td class="bytes">48</td>
<td class="instruction">PHA</td>
<td class="comment-1" rowspan="1">push compare evaluation byte if branch to here</td>
</tr>
<tr>
<td class="address-1"><span id="ADAA"></span>ADAA</td>
<td class="bytes">8A</td>
<td class="instruction">TXA</td>
<td class="comment-1" rowspan="1">copy precedence byte</td>
</tr>
<tr>
<td class="address-1"><span id="ADAB"></span>ADAB</td>
<td class="bytes">48</td>
<td class="instruction">PHA</td>
<td class="comment-1" rowspan="1">push precedence byte</td>
</tr>
<tr>
<td class="address-1"><span id="ADAC"></span>ADAC</td>
<td class="bytes">A9 01</td>
<td class="instruction">LDA #$01</td>
<td class="comment-1" rowspan="1">2 bytes</td>
</tr>
<tr>
<td class="address-1"><span id="ADAE"></span>ADAE</td>
<td class="bytes">20 FB A3</td>
<td class="instruction">JSR <a href="A3FB.html">$A3FB</a></td>
<td class="comment-1" rowspan="1">check room on stack for <span class="register">A</span>*2 bytes</td>
</tr>
<tr>
<td class="address-1"><span id="ADB1"></span>ADB1</td>
<td class="bytes">20 83 AE</td>
<td class="instruction">JSR <a href="AE83.html">$AE83</a></td>
<td class="comment-1" rowspan="1">get value from line</td>
</tr>
<tr>
<td class="address-1"><span id="ADB4"></span>ADB4</td>
<td class="bytes">A9 00</td>
<td class="instruction">LDA #$00</td>
<td class="comment-1" rowspan="1">clear <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="ADB6"></span>ADB6</td>
<td class="bytes">85 4D</td>
<td class="instruction">STA $4D</td>
<td class="comment-1" rowspan="1">clear comparrison evaluation flag</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="ADB8"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="B63D.html">B63D</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="ADB8"></span>ADB8</td>
<td class="bytes">20 79 00</td>
<td class="instruction">JSR $0079</td>
<td class="comment-1" rowspan="1">scan memory</td>
</tr>
<tr>
<td class="address-2"><span id="ADBB"></span>ADBB</td>
<td class="bytes">38</td>
<td class="instruction">SEC</td>
<td class="comment-1" rowspan="1">set carry for subtract</td>
</tr>
<tr>
<td class="address-1"><span id="ADBC"></span>ADBC</td>
<td class="bytes">E9 B1</td>
<td class="instruction">SBC #$B1</td>
<td class="comment-1" rowspan="1">subtract the token for "&gt;"</td>
</tr>
<tr>
<td class="address-1"><span id="ADBE"></span>ADBE</td>
<td class="bytes">90 17</td>
<td class="instruction">BCC <a href="AD9E.html#ADD7">$ADD7</a></td>
<td class="comment-1" rowspan="1">branch if &lt; "&gt;"</td>
</tr>
<tr>
<td class="address-1"><span id="ADC0"></span>ADC0</td>
<td class="bytes">C9 03</td>
<td class="instruction">CMP #$03</td>
<td class="comment-1" rowspan="1">compare with "&gt;" to +3</td>
</tr>
<tr>
<td class="address-1"><span id="ADC2"></span>ADC2</td>
<td class="bytes">B0 13</td>
<td class="instruction">BCS <a href="AD9E.html#ADD7">$ADD7</a></td>
<td class="comment-1" rowspan="1">branch if &gt;= 3</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="ADC4"></span>
<div class="comments">
<div class="paragraph">
was token for "&gt;" "=" or "&lt;"
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="ADC4"></span>ADC4</td>
<td class="bytes">C9 01</td>
<td class="instruction">CMP #$01</td>
<td class="comment-1" rowspan="1">compare with token for =</td>
</tr>
<tr>
<td class="address-1"><span id="ADC6"></span>ADC6</td>
<td class="bytes">2A</td>
<td class="instruction">ROL A</td>
<td class="comment-1" rowspan="1">*2, b0 = carry (=1 if token was = or &lt;)</td>
</tr>
<tr>
<td class="address-1"><span id="ADC7"></span>ADC7</td>
<td class="bytes">49 01</td>
<td class="instruction">EOR #%00000001</td>
<td class="comment-1" rowspan="1">toggle b0</td>
</tr>
<tr>
<td class="address-1"><span id="ADC9"></span>ADC9</td>
<td class="bytes">45 4D</td>
<td class="instruction">EOR $4D</td>
<td class="comment-1" rowspan="1">EOR with comparison evaluation flag</td>
</tr>
<tr>
<td class="address-1"><span id="ADCB"></span>ADCB</td>
<td class="bytes">C5 4D</td>
<td class="instruction">CMP $4D</td>
<td class="comment-1" rowspan="1">compare with comparison evaluation flag</td>
</tr>
<tr>
<td class="address-1"><span id="ADCD"></span>ADCD</td>
<td class="bytes">90 61</td>
<td class="instruction">BCC <a href="AE30.html">$AE30</a></td>
<td class="comment-1" rowspan="1">if &lt; saved flag do syntax error then warm start</td>
</tr>
<tr>
<td class="address-1"><span id="ADCF"></span>ADCF</td>
<td class="bytes">85 4D</td>
<td class="instruction">STA $4D</td>
<td class="comment-1" rowspan="1">save new comparison evaluation flag</td>
</tr>
<tr>
<td class="address-1"><span id="ADD1"></span>ADD1</td>
<td class="bytes">20 73 00</td>
<td class="instruction">JSR $0073</td>
<td class="comment-1" rowspan="1">increment and scan memory</td>
</tr>
<tr>
<td class="address-1"><span id="ADD4"></span>ADD4</td>
<td class="bytes">4C BB AD</td>
<td class="instruction">JMP <a href="AD9E.html#ADBB">$ADBB</a></td>
<td class="comment-1" rowspan="1">go do next character</td>
</tr>
<tr>
<td class="address-2"><span id="ADD7"></span>ADD7</td>
<td class="bytes">A6 4D</td>
<td class="instruction">LDX $4D</td>
<td class="comment-1" rowspan="1">get comparison evaluation flag</td>
</tr>
<tr>
<td class="address-1"><span id="ADD9"></span>ADD9</td>
<td class="bytes">D0 2C</td>
<td class="instruction">BNE <a href="AD9E.html#AE07">$AE07</a></td>
<td class="comment-1" rowspan="1">branch if compare function</td>
</tr>
<tr>
<td class="address-1"><span id="ADDB"></span>ADDB</td>
<td class="bytes">B0 7B</td>
<td class="instruction">BCS <a href="AE58.html">$AE58</a></td>
<td class="comment-1" rowspan="1">go do functions</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="ADDD"></span>
<div class="comments">
<div class="paragraph">
else was &lt; TK_GT so is operator or lower
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="ADDD"></span>ADDD</td>
<td class="bytes">69 07</td>
<td class="instruction">ADC #$07</td>
<td class="comment-1" rowspan="1">add # of operators (+, -, *, /, ^, AND or OR)</td>
</tr>
<tr>
<td class="address-1"><span id="ADDF"></span>ADDF</td>
<td class="bytes">90 77</td>
<td class="instruction">BCC <a href="AE58.html">$AE58</a></td>
<td class="comment-1" rowspan="1">branch if &lt; + operator</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="ADE1"></span>
<div class="comments">
<div class="paragraph">
carry was set so token was +, -, *, /, ^, AND or OR
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="ADE1"></span>ADE1</td>
<td class="bytes">65 0D</td>
<td class="instruction">ADC $0D</td>
<td class="comment-1" rowspan="1">add data type flag, $FF = string, $00 = numeric</td>
</tr>
<tr>
<td class="address-1"><span id="ADE3"></span>ADE3</td>
<td class="bytes">D0 03</td>
<td class="instruction">BNE <a href="AD9E.html#ADE8">$ADE8</a></td>
<td class="comment-1" rowspan="1">branch if not string or not + token</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="ADE5"></span>
<div class="comments">
<div class="paragraph">
will only be $00 if type is string and token was +
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="ADE5"></span>ADE5</td>
<td class="bytes">4C 3D B6</td>
<td class="instruction">JMP <a href="B63D.html">$B63D</a></td>
<td class="comment-1" rowspan="1">add strings, string 1 is in the descriptor, string 2 is in line, and return</td>
</tr>
<tr>
<td class="address-2"><span id="ADE8"></span>ADE8</td>
<td class="bytes">69 FF</td>
<td class="instruction">ADC #$FF</td>
<td class="comment-1" rowspan="1">-1 (corrects for carry add)</td>
</tr>
<tr>
<td class="address-1"><span id="ADEA"></span>ADEA</td>
<td class="bytes">85 22</td>
<td class="instruction">STA $22</td>
<td class="comment-1" rowspan="1">save it</td>
</tr>
<tr>
<td class="address-1"><span id="ADEC"></span>ADEC</td>
<td class="bytes">0A</td>
<td class="instruction">ASL A</td>
<td class="comment-1" rowspan="1">*2</td>
</tr>
<tr>
<td class="address-1"><span id="ADED"></span>ADED</td>
<td class="bytes">65 22</td>
<td class="instruction">ADC $22</td>
<td class="comment-1" rowspan="1">*3</td>
</tr>
<tr>
<td class="address-1"><span id="ADEF"></span>ADEF</td>
<td class="bytes">A8</td>
<td class="instruction">TAY</td>
<td class="comment-1" rowspan="1">copy to index</td>
</tr>
<tr>
<td class="address-2"><span id="ADF0"></span>ADF0</td>
<td class="bytes">68</td>
<td class="instruction">PLA</td>
<td class="comment-1" rowspan="1">pull previous precedence</td>
</tr>
<tr>
<td class="address-1"><span id="ADF1"></span>ADF1</td>
<td class="bytes">D9 80 A0</td>
<td class="instruction">CMP $A080,Y</td>
<td class="comment-1" rowspan="1">compare with precedence byte</td>
</tr>
<tr>
<td class="address-1"><span id="ADF4"></span>ADF4</td>
<td class="bytes">B0 67</td>
<td class="instruction">BCS <a href="AE58.html#AE5D">$AE5D</a></td>
<td class="comment-1" rowspan="1">branch if <span class="register">A</span> &gt;=</td>
</tr>
<tr>
<td class="address-1"><span id="ADF6"></span>ADF6</td>
<td class="bytes">20 8D AD</td>
<td class="instruction">JSR <a href="AD8A.html#AD8D">$AD8D</a></td>
<td class="comment-1" rowspan="1">check if source is numeric, else do type mismatch</td>
</tr>
<tr>
<td class="address-2"><span id="ADF9"></span>ADF9</td>
<td class="bytes">48</td>
<td class="instruction">PHA</td>
<td class="comment-1" rowspan="1">save precedence</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="ADFA"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="AE86.html">AE86</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="ADFA"></span>ADFA</td>
<td class="bytes">20 20 AE</td>
<td class="instruction">JSR <a href="AE20.html">$AE20</a></td>
<td class="comment-1" rowspan="1">get vector, execute function then continue evaluation</td>
</tr>
<tr>
<td class="address-1"><span id="ADFD"></span>ADFD</td>
<td class="bytes">68</td>
<td class="instruction">PLA</td>
<td class="comment-1" rowspan="1">restore precedence</td>
</tr>
<tr>
<td class="address-1"><span id="ADFE"></span>ADFE</td>
<td class="bytes">A4 4B</td>
<td class="instruction">LDY $4B</td>
<td class="comment-1" rowspan="1">get precedence stacked flag</td>
</tr>
<tr>
<td class="address-1"><span id="AE00"></span>AE00</td>
<td class="bytes">10 17</td>
<td class="instruction">BPL <a href="AD9E.html#AE19">$AE19</a></td>
<td class="comment-1" rowspan="1">branch if stacked values</td>
</tr>
<tr>
<td class="address-1"><span id="AE02"></span>AE02</td>
<td class="bytes">AA</td>
<td class="instruction">TAX</td>
<td class="comment-1" rowspan="1">copy precedence, set flags</td>
</tr>
<tr>
<td class="address-1"><span id="AE03"></span>AE03</td>
<td class="bytes">F0 56</td>
<td class="instruction">BEQ <a href="AE58.html#AE5B">$AE5B</a></td>
<td class="comment-1" rowspan="1">exit if done</td>
</tr>
<tr>
<td class="address-1"><span id="AE05"></span>AE05</td>
<td class="bytes">D0 5F</td>
<td class="instruction">BNE <a href="AE58.html#AE66">$AE66</a></td>
<td class="comment-1" rowspan="1">else pop FAC2 and return, branch always</td>
</tr>
<tr>
<td class="address-2"><span id="AE07"></span>AE07</td>
<td class="bytes">46 0D</td>
<td class="instruction">LSR $0D</td>
<td class="comment-1" rowspan="1">clear data type flag, $FF = string, $00 = numeric</td>
</tr>
<tr>
<td class="address-1"><span id="AE09"></span>AE09</td>
<td class="bytes">8A</td>
<td class="instruction">TXA</td>
<td class="comment-1" rowspan="1">copy compare function flag</td>
</tr>
<tr>
<td class="address-1"><span id="AE0A"></span>AE0A</td>
<td class="bytes">2A</td>
<td class="instruction">ROL A</td>
<td class="comment-1" rowspan="1">&lt;&lt;1, shift data type flag into b0, 1 = string, 0 = num</td>
</tr>
<tr>
<td class="address-1"><span id="AE0B"></span>AE0B</td>
<td class="bytes">A6 7A</td>
<td class="instruction">LDX $7A</td>
<td class="comment-1" rowspan="1">get BASIC execute pointer low byte</td>
</tr>
<tr>
<td class="address-1"><span id="AE0D"></span>AE0D</td>
<td class="bytes">D0 02</td>
<td class="instruction">BNE <a href="AD9E.html#AE11">$AE11</a></td>
<td class="comment-1" rowspan="1">branch if no underflow</td>
</tr>
<tr>
<td class="address-1"><span id="AE0F"></span>AE0F</td>
<td class="bytes">C6 7B</td>
<td class="instruction">DEC $7B</td>
<td class="comment-1" rowspan="1">else decrement BASIC execute pointer high byte</td>
</tr>
<tr>
<td class="address-2"><span id="AE11"></span>AE11</td>
<td class="bytes">C6 7A</td>
<td class="instruction">DEC $7A</td>
<td class="comment-1" rowspan="1">decrement BASIC execute pointer low byte</td>
</tr>
<tr>
<td class="address-1"><span id="AE13"></span>AE13</td>
<td class="bytes">A0 1B</td>
<td class="instruction">LDY #$1B</td>
<td class="comment-1" rowspan="1">set offset to = operator precedence entry</td>
</tr>
<tr>
<td class="address-1"><span id="AE15"></span>AE15</td>
<td class="bytes">85 4D</td>
<td class="instruction">STA $4D</td>
<td class="comment-1" rowspan="1">save new comparison evaluation flag</td>
</tr>
<tr>
<td class="address-1"><span id="AE17"></span>AE17</td>
<td class="bytes">D0 D7</td>
<td class="instruction">BNE <a href="AD9E.html#ADF0">$ADF0</a></td>
<td class="comment-1" rowspan="1">branch always</td>
</tr>
<tr>
<td class="address-2"><span id="AE19"></span>AE19</td>
<td class="bytes">D9 80 A0</td>
<td class="instruction">CMP $A080,Y</td>
<td class="comment-1" rowspan="1">compare with stacked function precedence</td>
</tr>
<tr>
<td class="address-1"><span id="AE1C"></span>AE1C</td>
<td class="bytes">B0 48</td>
<td class="instruction">BCS <a href="AE58.html#AE66">$AE66</a></td>
<td class="comment-1" rowspan="1">if <span class="register">A</span> &gt;=, pop FAC2 and return</td>
</tr>
<tr>
<td class="address-1"><span id="AE1E"></span>AE1E</td>
<td class="bytes">90 D9</td>
<td class="instruction">BCC <a href="AD9E.html#ADF9">$ADF9</a></td>
<td class="comment-1" rowspan="1">else go stack this one and continue, branch always</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="AD8A.html">AD8A</a>
</td>
<td class="up">Up: <a href="../maps/all.html#AD9E">Map</a></td>
<td class="next">
Next: <a href="AE20.html">AE20</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&#169; 2012 Lee Davison.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.0 and <a href="https://github.com/skoolkid/sk6502">sk6502</a>.</div>
</footer>
</body>
</html>