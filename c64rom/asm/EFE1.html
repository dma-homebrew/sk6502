<!DOCTYPE html>
<html>
<head>
<title>C64 ROM: Routine at EFE1</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html">C64 ROM</a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="EFDB.html">EFDB</a>
</td>
<td class="up">Up: <a href="../maps/all.html#EFE1">Map</a></td>
<td class="next">
Next: <a href="F014.html">F014</a>
</td>
</tr>
</table>
<div class="description">EFE1: open RS232 channel for output</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="F250.html">F250</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="EFE1"></span>EFE1</td>
<td class="bytes">85 9A</td>
<td class="instruction">STA $9A</td>
<td class="comment-1" rowspan="1">save the output device number</td>
</tr>
<tr>
<td class="address-1"><span id="EFE3"></span>EFE3</td>
<td class="bytes">AD 94 02</td>
<td class="instruction">LDA $0294</td>
<td class="comment-1" rowspan="1">read the pseudo 6551 command register</td>
</tr>
<tr>
<td class="address-1"><span id="EFE6"></span>EFE6</td>
<td class="bytes">4A</td>
<td class="instruction">LSR A</td>
<td class="comment-1" rowspan="1">shift handshake bit to carry</td>
</tr>
<tr>
<td class="address-1"><span id="EFE7"></span>EFE7</td>
<td class="bytes">90 29</td>
<td class="instruction">BCC <a href="EFE1.html#F012">$F012</a></td>
<td class="comment-1" rowspan="1">if 3 line interface go ??</td>
</tr>
<tr>
<td class="address-1"><span id="EFE9"></span>EFE9</td>
<td class="bytes">A9 02</td>
<td class="instruction">LDA #%00000010</td>
<td class="comment-1" rowspan="1">mask 0000 00x0, RTS out</td>
</tr>
<tr>
<td class="address-1"><span id="EFEB"></span>EFEB</td>
<td class="bytes">2C 01 DD</td>
<td class="instruction">BIT $DD01</td>
<td class="comment-1" rowspan="1">test VIA 2 DRB, RS232 port</td>
</tr>
<tr>
<td class="address-1"><span id="EFEE"></span>EFEE</td>
<td class="bytes">10 1D</td>
<td class="instruction">BPL <a href="EFE1.html#F00D">$F00D</a></td>
<td class="comment-1" rowspan="1">if DSR = 0 set DSR not present and exit</td>
</tr>
<tr>
<td class="address-1"><span id="EFF0"></span>EFF0</td>
<td class="bytes">D0 20</td>
<td class="instruction">BNE <a href="EFE1.html#F012">$F012</a></td>
<td class="comment-1" rowspan="1">if RTS = 1 just exit</td>
</tr>
<tr>
<td class="address-2"><span id="EFF2"></span>EFF2</td>
<td class="bytes">AD A1 02</td>
<td class="instruction">LDA $02A1</td>
<td class="comment-1" rowspan="1">get the RS-232 interrupt enable byte</td>
</tr>
<tr>
<td class="address-1"><span id="EFF5"></span>EFF5</td>
<td class="bytes">29 02</td>
<td class="instruction">AND #$02</td>
<td class="comment-1" rowspan="1">mask 0000 00x0, timer B interrupt</td>
</tr>
<tr>
<td class="address-1"><span id="EFF7"></span>EFF7</td>
<td class="bytes">D0 F9</td>
<td class="instruction">BNE <a href="EFE1.html#EFF2">$EFF2</a></td>
<td class="comment-1" rowspan="1">loop while the timer B interrupt is enebled</td>
</tr>
<tr>
<td class="address-2"><span id="EFF9"></span>EFF9</td>
<td class="bytes">2C 01 DD</td>
<td class="instruction">BIT $DD01</td>
<td class="comment-1" rowspan="1">test VIA 2 DRB, RS232 port</td>
</tr>
<tr>
<td class="address-1"><span id="EFFC"></span>EFFC</td>
<td class="bytes">70 FB</td>
<td class="instruction">BVS <a href="EFE1.html#EFF9">$EFF9</a></td>
<td class="comment-1" rowspan="1">loop while CTS high</td>
</tr>
<tr>
<td class="address-1"><span id="EFFE"></span>EFFE</td>
<td class="bytes">AD 01 DD</td>
<td class="instruction">LDA $DD01</td>
<td class="comment-1" rowspan="1">read VIA 2 DRB, RS232 port</td>
</tr>
<tr>
<td class="address-1"><span id="F001"></span>F001</td>
<td class="bytes">09 02</td>
<td class="instruction">ORA #%00000010</td>
<td class="comment-1" rowspan="1">mask xxxx xx1x, set RTS high</td>
</tr>
<tr>
<td class="address-1"><span id="F003"></span>F003</td>
<td class="bytes">8D 01 DD</td>
<td class="instruction">STA $DD01</td>
<td class="comment-1" rowspan="1">save VIA 2 DRB, RS232 port</td>
</tr>
<tr>
<td class="address-2"><span id="F006"></span>F006</td>
<td class="bytes">2C 01 DD</td>
<td class="instruction">BIT $DD01</td>
<td class="comment-1" rowspan="1">test VIA 2 DRB, RS232 port</td>
</tr>
<tr>
<td class="address-1"><span id="F009"></span>F009</td>
<td class="bytes">70 07</td>
<td class="instruction">BVS <a href="EFE1.html#F012">$F012</a></td>
<td class="comment-1" rowspan="1">exit if CTS high</td>
</tr>
<tr>
<td class="address-1"><span id="F00B"></span>F00B</td>
<td class="bytes">30 F9</td>
<td class="instruction">BMI <a href="EFE1.html#F006">$F006</a></td>
<td class="comment-1" rowspan="1">loop while DSR high</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="F00D"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routines at <a href="F04D.html">F04D</a> and <a href="F409.html">F409</a>.
</div>
<div class="paragraph">
set no DSR and exit
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="F00D"></span>F00D</td>
<td class="bytes">A9 40</td>
<td class="instruction">LDA #$40</td>
<td class="comment-1" rowspan="1">set DSR signal not present</td>
</tr>
<tr>
<td class="address-1"><span id="F00F"></span>F00F</td>
<td class="bytes">8D 97 02</td>
<td class="instruction">STA $0297</td>
<td class="comment-1" rowspan="1">save the RS232 status register</td>
</tr>
<tr>
<td class="address-2"><span id="F012"></span>F012</td>
<td class="bytes">18</td>
<td class="instruction">CLC</td>
<td class="comment-1" rowspan="1">flag ok</td>
</tr>
<tr>
<td class="address-1"><span id="F013"></span>F013</td>
<td class="bytes">60</td>
<td class="instruction">RTS</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="EFDB.html">EFDB</a>
</td>
<td class="up">Up: <a href="../maps/all.html#EFE1">Map</a></td>
<td class="next">
Next: <a href="F014.html">F014</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&#169; 2012 Lee Davison.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.0 and <a href="https://github.com/skoolkid/sk6502">sk6502</a>.</div>
</footer>
</body>
</html>