<!DOCTYPE html>
<html>
<head>
<title>C64 ROM: Routine at B016</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html">C64 ROM</a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="AFE9.html">AFE9</a>
</td>
<td class="up">Up: <a href="../maps/all.html#B016">Map</a></td>
<td class="next">
Next: <a href="B07E.html">B07E</a>
</td>
</tr>
</table>
<div class="description">B016: perform comparisons</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
do &lt; compare
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="B016"></span>B016</td>
<td class="bytes">20 90 AD</td>
<td class="instruction">JSR <a href="AD8A.html#AD90">$AD90</a></td>
<td class="comment-1" rowspan="1">type match check, set C for string</td>
</tr>
<tr>
<td class="address-1"><span id="B019"></span>B019</td>
<td class="bytes">B0 13</td>
<td class="instruction">BCS <a href="B016.html#B02E">$B02E</a></td>
<td class="comment-1" rowspan="1">branch if string</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="B01B"></span>
<div class="comments">
<div class="paragraph">
do numeric &lt; compare
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="B01B"></span>B01B</td>
<td class="bytes">A5 6E</td>
<td class="instruction">LDA $6E</td>
<td class="comment-1" rowspan="1">get FAC2 sign (b7)</td>
</tr>
<tr>
<td class="address-1"><span id="B01D"></span>B01D</td>
<td class="bytes">09 7F</td>
<td class="instruction">ORA #$7F</td>
<td class="comment-1" rowspan="1">set all non sign bits</td>
</tr>
<tr>
<td class="address-1"><span id="B01F"></span>B01F</td>
<td class="bytes">25 6A</td>
<td class="instruction">AND $6A</td>
<td class="comment-1" rowspan="1">and FAC2 mantissa 1 (AND in sign bit)</td>
</tr>
<tr>
<td class="address-1"><span id="B021"></span>B021</td>
<td class="bytes">85 6A</td>
<td class="instruction">STA $6A</td>
<td class="comment-1" rowspan="1">save FAC2 mantissa 1</td>
</tr>
<tr>
<td class="address-1"><span id="B023"></span>B023</td>
<td class="bytes">A9 69</td>
<td class="instruction">LDA #$69</td>
<td class="comment-1" rowspan="1">set pointer low byte to FAC2</td>
</tr>
<tr>
<td class="address-1"><span id="B025"></span>B025</td>
<td class="bytes">A0 00</td>
<td class="instruction">LDY #$00</td>
<td class="comment-1" rowspan="1">set pointer high byte to FAC2</td>
</tr>
<tr>
<td class="address-1"><span id="B027"></span>B027</td>
<td class="bytes">20 5B BC</td>
<td class="instruction">JSR <a href="BC5B.html">$BC5B</a></td>
<td class="comment-1" rowspan="1">compare FAC1 with (<span class="register">AY</span>)</td>
</tr>
<tr>
<td class="address-1"><span id="B02A"></span>B02A</td>
<td class="bytes">AA</td>
<td class="instruction">TAX</td>
<td class="comment-1" rowspan="1">copy the result</td>
</tr>
<tr>
<td class="address-1"><span id="B02B"></span>B02B</td>
<td class="bytes">4C 61 B0</td>
<td class="instruction">JMP <a href="B016.html#B061">$B061</a></td>
<td class="comment-1" rowspan="1">go evaluate result</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="B02E"></span>
<div class="comments">
<div class="paragraph">
do string &lt; compare
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="B02E"></span>B02E</td>
<td class="bytes">A9 00</td>
<td class="instruction">LDA #$00</td>
<td class="comment-1" rowspan="1">clear byte</td>
</tr>
<tr>
<td class="address-1"><span id="B030"></span>B030</td>
<td class="bytes">85 0D</td>
<td class="instruction">STA $0D</td>
<td class="comment-1" rowspan="1">clear data type flag, $FF = string, $00 = numeric</td>
</tr>
<tr>
<td class="address-1"><span id="B032"></span>B032</td>
<td class="bytes">C6 4D</td>
<td class="instruction">DEC $4D</td>
<td class="comment-1" rowspan="1">clear &lt; bit in comparrison evaluation flag</td>
</tr>
<tr>
<td class="address-1"><span id="B034"></span>B034</td>
<td class="bytes">20 A6 B6</td>
<td class="instruction">JSR <a href="B6A3.html#B6A6">$B6A6</a></td>
<td class="comment-1" rowspan="1">pop string off descriptor stack, or from top of string space</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="B037"></span>
<div class="comments">
<div class="paragraph">
returns with <span class="register">A</span> = length, <span class="register">X</span> = pointer low byte, <span class="register">Y</span> = pointer high byte
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="B037"></span>B037</td>
<td class="bytes">85 61</td>
<td class="instruction">STA $61</td>
<td class="comment-1" rowspan="1">save length</td>
</tr>
<tr>
<td class="address-1"><span id="B039"></span>B039</td>
<td class="bytes">86 62</td>
<td class="instruction">STX $62</td>
<td class="comment-1" rowspan="1">save string pointer low byte</td>
</tr>
<tr>
<td class="address-1"><span id="B03B"></span>B03B</td>
<td class="bytes">84 63</td>
<td class="instruction">STY $63</td>
<td class="comment-1" rowspan="1">save string pointer high byte</td>
</tr>
<tr>
<td class="address-1"><span id="B03D"></span>B03D</td>
<td class="bytes">A5 6C</td>
<td class="instruction">LDA $6C</td>
<td class="comment-1" rowspan="1">get descriptor pointer low byte</td>
</tr>
<tr>
<td class="address-1"><span id="B03F"></span>B03F</td>
<td class="bytes">A4 6D</td>
<td class="instruction">LDY $6D</td>
<td class="comment-1" rowspan="1">get descriptor pointer high byte</td>
</tr>
<tr>
<td class="address-1"><span id="B041"></span>B041</td>
<td class="bytes">20 AA B6</td>
<td class="instruction">JSR <a href="B6A3.html#B6AA">$B6AA</a></td>
<td class="comment-1" rowspan="1">pop (<span class="register">YA</span>) descriptor off stack or from top of string space</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="B044"></span>
<div class="comments">
<div class="paragraph">
returns with <span class="register">A</span> = length, <span class="register">X</span> = pointer low byte, <span class="register">Y</span> = pointer high byte
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="B044"></span>B044</td>
<td class="bytes">86 6C</td>
<td class="instruction">STX $6C</td>
<td class="comment-1" rowspan="1">save string pointer low byte</td>
</tr>
<tr>
<td class="address-1"><span id="B046"></span>B046</td>
<td class="bytes">84 6D</td>
<td class="instruction">STY $6D</td>
<td class="comment-1" rowspan="1">save string pointer high byte</td>
</tr>
<tr>
<td class="address-1"><span id="B048"></span>B048</td>
<td class="bytes">AA</td>
<td class="instruction">TAX</td>
<td class="comment-1" rowspan="1">copy length</td>
</tr>
<tr>
<td class="address-1"><span id="B049"></span>B049</td>
<td class="bytes">38</td>
<td class="instruction">SEC</td>
<td class="comment-1" rowspan="1">set carry for subtract</td>
</tr>
<tr>
<td class="address-1"><span id="B04A"></span>B04A</td>
<td class="bytes">E5 61</td>
<td class="instruction">SBC $61</td>
<td class="comment-1" rowspan="1">subtract string 1 length</td>
</tr>
<tr>
<td class="address-1"><span id="B04C"></span>B04C</td>
<td class="bytes">F0 08</td>
<td class="instruction">BEQ <a href="B016.html#B056">$B056</a></td>
<td class="comment-1" rowspan="1">branch if str 1 length = string 2 length</td>
</tr>
<tr>
<td class="address-1"><span id="B04E"></span>B04E</td>
<td class="bytes">A9 01</td>
<td class="instruction">LDA #$01</td>
<td class="comment-1" rowspan="1">set str 1 length &gt; string 2 length</td>
</tr>
<tr>
<td class="address-1"><span id="B050"></span>B050</td>
<td class="bytes">90 04</td>
<td class="instruction">BCC <a href="B016.html#B056">$B056</a></td>
<td class="comment-1" rowspan="1">branch if so</td>
</tr>
<tr>
<td class="address-1"><span id="B052"></span>B052</td>
<td class="bytes">A6 61</td>
<td class="instruction">LDX $61</td>
<td class="comment-1" rowspan="1">get string 1 length</td>
</tr>
<tr>
<td class="address-1"><span id="B054"></span>B054</td>
<td class="bytes">A9 FF</td>
<td class="instruction">LDA #$FF</td>
<td class="comment-1" rowspan="1">set str 1 length &lt; string 2 length</td>
</tr>
<tr>
<td class="address-2"><span id="B056"></span>B056</td>
<td class="bytes">85 66</td>
<td class="instruction">STA $66</td>
<td class="comment-1" rowspan="1">save length compare</td>
</tr>
<tr>
<td class="address-1"><span id="B058"></span>B058</td>
<td class="bytes">A0 FF</td>
<td class="instruction">LDY #$FF</td>
<td class="comment-1" rowspan="1">set index</td>
</tr>
<tr>
<td class="address-1"><span id="B05A"></span>B05A</td>
<td class="bytes">E8</td>
<td class="instruction">INX</td>
<td class="comment-1" rowspan="1">adjust for loop</td>
</tr>
<tr>
<td class="address-2"><span id="B05B"></span>B05B</td>
<td class="bytes">C8</td>
<td class="instruction">INY</td>
<td class="comment-1" rowspan="1">increment index</td>
</tr>
<tr>
<td class="address-1"><span id="B05C"></span>B05C</td>
<td class="bytes">CA</td>
<td class="instruction">DEX</td>
<td class="comment-1" rowspan="1">decrement count</td>
</tr>
<tr>
<td class="address-1"><span id="B05D"></span>B05D</td>
<td class="bytes">D0 07</td>
<td class="instruction">BNE <a href="B016.html#B066">$B066</a></td>
<td class="comment-1" rowspan="1">branch if still bytes to do</td>
</tr>
<tr>
<td class="address-1"><span id="B05F"></span>B05F</td>
<td class="bytes">A6 66</td>
<td class="instruction">LDX $66</td>
<td class="comment-1" rowspan="1">get length compare back</td>
</tr>
<tr>
<td class="address-2"><span id="B061"></span>B061</td>
<td class="bytes">30 0F</td>
<td class="instruction">BMI <a href="B016.html#B072">$B072</a></td>
<td class="comment-1" rowspan="1">branch if str 1 &lt; str 2</td>
</tr>
<tr>
<td class="address-1"><span id="B063"></span>B063</td>
<td class="bytes">18</td>
<td class="instruction">CLC</td>
<td class="comment-1" rowspan="1">flag str 1 &lt;= str 2</td>
</tr>
<tr>
<td class="address-1"><span id="B064"></span>B064</td>
<td class="bytes">90 0C</td>
<td class="instruction">BCC <a href="B016.html#B072">$B072</a></td>
<td class="comment-1" rowspan="1">go evaluate result</td>
</tr>
<tr>
<td class="address-2"><span id="B066"></span>B066</td>
<td class="bytes">B1 6C</td>
<td class="instruction">LDA ($6C),Y</td>
<td class="comment-1" rowspan="1">get string 2 byte</td>
</tr>
<tr>
<td class="address-1"><span id="B068"></span>B068</td>
<td class="bytes">D1 62</td>
<td class="instruction">CMP ($62),Y</td>
<td class="comment-1" rowspan="1">compare with string 1 byte</td>
</tr>
<tr>
<td class="address-1"><span id="B06A"></span>B06A</td>
<td class="bytes">F0 EF</td>
<td class="instruction">BEQ <a href="B016.html#B05B">$B05B</a></td>
<td class="comment-1" rowspan="1">loop if bytes =</td>
</tr>
<tr>
<td class="address-1"><span id="B06C"></span>B06C</td>
<td class="bytes">A2 FF</td>
<td class="instruction">LDX #$FF</td>
<td class="comment-1" rowspan="1">set str 1 &lt; string 2</td>
</tr>
<tr>
<td class="address-1"><span id="B06E"></span>B06E</td>
<td class="bytes">B0 02</td>
<td class="instruction">BCS <a href="B016.html#B072">$B072</a></td>
<td class="comment-1" rowspan="1">branch if so</td>
</tr>
<tr>
<td class="address-1"><span id="B070"></span>B070</td>
<td class="bytes">A2 01</td>
<td class="instruction">LDX #$01</td>
<td class="comment-1" rowspan="1">set str 1 &gt; string 2</td>
</tr>
<tr>
<td class="address-2"><span id="B072"></span>B072</td>
<td class="bytes">E8</td>
<td class="instruction">INX</td>
<td class="comment-1" rowspan="1">x = 0, 1 or 2</td>
</tr>
<tr>
<td class="address-1"><span id="B073"></span>B073</td>
<td class="bytes">8A</td>
<td class="instruction">TXA</td>
<td class="comment-1" rowspan="1">copy to <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="B074"></span>B074</td>
<td class="bytes">2A</td>
<td class="instruction">ROL A</td>
<td class="comment-1" rowspan="1">* 2 (1, 2 or 4)</td>
</tr>
<tr>
<td class="address-1"><span id="B075"></span>B075</td>
<td class="bytes">25 12</td>
<td class="instruction">AND $12</td>
<td class="comment-1" rowspan="1">AND with the comparison evaluation flag</td>
</tr>
<tr>
<td class="address-1"><span id="B077"></span>B077</td>
<td class="bytes">F0 02</td>
<td class="instruction">BEQ <a href="B016.html#B07B">$B07B</a></td>
<td class="comment-1" rowspan="1">branch if 0 (compare is false)</td>
</tr>
<tr>
<td class="address-1"><span id="B079"></span>B079</td>
<td class="bytes">A9 FF</td>
<td class="instruction">LDA #$FF</td>
<td class="comment-1" rowspan="1">else set result true</td>
</tr>
<tr>
<td class="address-2"><span id="B07B"></span>B07B</td>
<td class="bytes">4C 3C BC</td>
<td class="instruction">JMP <a href="BC3C.html">$BC3C</a></td>
<td class="comment-1" rowspan="1">save <span class="register">A</span> as integer byte and return</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="AFE9.html">AFE9</a>
</td>
<td class="up">Up: <a href="../maps/all.html#B016">Map</a></td>
<td class="next">
Next: <a href="B07E.html">B07E</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&#169; 2012 Lee Davison.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.0 and <a href="https://github.com/skoolkid/sk6502">sk6502</a>.</div>
</footer>
</body>
</html>