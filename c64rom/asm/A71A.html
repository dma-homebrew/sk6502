<!DOCTYPE html>
<html>
<head>
<title>C64 ROM: Routine at A71A</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html">C64 ROM</a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="A69C.html">A69C</a>
</td>
<td class="up">Up: <a href="../maps/all.html#A71A">Map</a></td>
<td class="next">
Next: <a href="A742.html">A742</a>
</td>
</tr>
</table>
<div class="description">A71A: uncrunch BASIC tokens</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
the uncrunch BASIC tokens vector is initialised to point here
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="A71A"></span>A71A</td>
<td class="bytes">10 D7</td>
<td class="instruction">BPL <a href="A69C.html#A6F3">$A6F3</a></td>
<td class="comment-1" rowspan="1">just go print it if not token byte</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="A71C"></span>
<div class="comments">
<div class="paragraph">
else was token byte so uncrunch it
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="A71C"></span>A71C</td>
<td class="bytes">C9 FF</td>
<td class="instruction">CMP #$FF</td>
<td class="comment-1" rowspan="1">compare with the token for PI. in this case the token is the same as the PI character so it just needs printing</td>
</tr>
<tr>
<td class="address-1"><span id="A71E"></span>A71E</td>
<td class="bytes">F0 D3</td>
<td class="instruction">BEQ <a href="A69C.html#A6F3">$A6F3</a></td>
<td class="comment-1" rowspan="1">just print it if so</td>
</tr>
<tr>
<td class="address-1"><span id="A720"></span>A720</td>
<td class="bytes">24 0F</td>
<td class="instruction">BIT $0F</td>
<td class="comment-1" rowspan="1">test the open quote flag</td>
</tr>
<tr>
<td class="address-1"><span id="A722"></span>A722</td>
<td class="bytes">30 CF</td>
<td class="instruction">BMI <a href="A69C.html#A6F3">$A6F3</a></td>
<td class="comment-1" rowspan="1">just go print character if open quote set</td>
</tr>
<tr>
<td class="address-1"><span id="A724"></span>A724</td>
<td class="bytes">38</td>
<td class="instruction">SEC</td>
<td class="comment-1" rowspan="1">else set carry for subtract</td>
</tr>
<tr>
<td class="address-1"><span id="A725"></span>A725</td>
<td class="bytes">E9 7F</td>
<td class="instruction">SBC #$7F</td>
<td class="comment-1" rowspan="1">reduce token range to 1 to whatever</td>
</tr>
<tr>
<td class="address-1"><span id="A727"></span>A727</td>
<td class="bytes">AA</td>
<td class="instruction">TAX</td>
<td class="comment-1" rowspan="1">copy token # to <span class="register">X</span></td>
</tr>
<tr>
<td class="address-1"><span id="A728"></span>A728</td>
<td class="bytes">84 49</td>
<td class="instruction">STY $49</td>
<td class="comment-1" rowspan="1">save index for line</td>
</tr>
<tr>
<td class="address-1"><span id="A72A"></span>A72A</td>
<td class="bytes">A0 FF</td>
<td class="instruction">LDY #$FF</td>
<td class="comment-1" rowspan="1">start from -1, adjust for pre increment</td>
</tr>
<tr>
<td class="address-2"><span id="A72C"></span>A72C</td>
<td class="bytes">CA</td>
<td class="instruction">DEX</td>
<td class="comment-1" rowspan="1">decrement token #</td>
</tr>
<tr>
<td class="address-1"><span id="A72D"></span>A72D</td>
<td class="bytes">F0 08</td>
<td class="instruction">BEQ <a href="A71A.html#A737">$A737</a></td>
<td class="comment-1" rowspan="1">if now found go do printing</td>
</tr>
<tr>
<td class="address-2"><span id="A72F"></span>A72F</td>
<td class="bytes">C8</td>
<td class="instruction">INY</td>
<td class="comment-1" rowspan="1">else increment index</td>
</tr>
<tr>
<td class="address-1"><span id="A730"></span>A730</td>
<td class="bytes">B9 9E A0</td>
<td class="instruction">LDA $A09E,Y</td>
<td class="comment-1" rowspan="1">get byte from keyword table</td>
</tr>
<tr>
<td class="address-1"><span id="A733"></span>A733</td>
<td class="bytes">10 FA</td>
<td class="instruction">BPL <a href="A71A.html#A72F">$A72F</a></td>
<td class="comment-1" rowspan="1">loop until keyword end marker</td>
</tr>
<tr>
<td class="address-1"><span id="A735"></span>A735</td>
<td class="bytes">30 F5</td>
<td class="instruction">BMI <a href="A71A.html#A72C">$A72C</a></td>
<td class="comment-1" rowspan="1">go test if this is required keyword, branch always</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="A737"></span>
<div class="comments">
<div class="paragraph">
found keyword, it's the next one
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="A737"></span>A737</td>
<td class="bytes">C8</td>
<td class="instruction">INY</td>
<td class="comment-1" rowspan="1">increment keyword table index</td>
</tr>
<tr>
<td class="address-1"><span id="A738"></span>A738</td>
<td class="bytes">B9 9E A0</td>
<td class="instruction">LDA $A09E,Y</td>
<td class="comment-1" rowspan="1">get byte from table</td>
</tr>
<tr>
<td class="address-1"><span id="A73B"></span>A73B</td>
<td class="bytes">30 B2</td>
<td class="instruction">BMI <a href="A69C.html#A6EF">$A6EF</a></td>
<td class="comment-1" rowspan="1">go restore index, mask byte and print if byte was end marker</td>
</tr>
<tr>
<td class="address-1"><span id="A73D"></span>A73D</td>
<td class="bytes">20 47 AB</td>
<td class="instruction">JSR <a href="AB47.html">$AB47</a></td>
<td class="comment-1" rowspan="1">else go print the character</td>
</tr>
<tr>
<td class="address-1"><span id="A740"></span>A740</td>
<td class="bytes">D0 F5</td>
<td class="instruction">BNE <a href="A71A.html#A737">$A737</a></td>
<td class="comment-1" rowspan="1">go get next character, branch always</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="A69C.html">A69C</a>
</td>
<td class="up">Up: <a href="../maps/all.html#A71A">Map</a></td>
<td class="next">
Next: <a href="A742.html">A742</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&#169; 2012 Lee Davison.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.0 and <a href="https://github.com/skoolkid/sk6502">sk6502</a>.</div>
</footer>
</body>
</html>