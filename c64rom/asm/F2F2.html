<!DOCTYPE html>
<html>
<head>
<title>C64 ROM: Routine at F2F2</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html">C64 ROM</a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="F2EE.html">F2EE</a>
</td>
<td class="up">Up: <a href="../maps/all.html#F2F2">Map</a></td>
<td class="next">
Next: <a href="F30F.html">F30F</a>
</td>
</tr>
</table>
<div class="description">F2F2: close file index <span class="register">X</span></div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="F291.html">F291</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="F2F2"></span>F2F2</td>
<td class="bytes">AA</td>
<td class="instruction">TAX</td>
<td class="comment-1" rowspan="1">copy index to file to close</td>
</tr>
<tr>
<td class="address-1"><span id="F2F3"></span>F2F3</td>
<td class="bytes">C6 98</td>
<td class="instruction">DEC $98</td>
<td class="comment-1" rowspan="1">decrement the open file count</td>
</tr>
<tr>
<td class="address-1"><span id="F2F5"></span>F2F5</td>
<td class="bytes">E4 98</td>
<td class="instruction">CPX $98</td>
<td class="comment-1" rowspan="1">compare the index with the open file count</td>
</tr>
<tr>
<td class="address-1"><span id="F2F7"></span>F2F7</td>
<td class="bytes">F0 14</td>
<td class="instruction">BEQ <a href="F2F2.html#F30D">$F30D</a></td>
<td class="comment-1" rowspan="1">exit if equal, last entry was closing file</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="F2F9"></span>
<div class="comments">
<div class="paragraph">
else entry was not last in list so copy last table entry file details over the details of the closing one
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="F2F9"></span>F2F9</td>
<td class="bytes">A4 98</td>
<td class="instruction">LDY $98</td>
<td class="comment-1" rowspan="1">get the open file count as index</td>
</tr>
<tr>
<td class="address-1"><span id="F2FB"></span>F2FB</td>
<td class="bytes">B9 59 02</td>
<td class="instruction">LDA $0259,Y</td>
<td class="comment-1" rowspan="1">get last+1 logical file number from logical file table</td>
</tr>
<tr>
<td class="address-1"><span id="F2FE"></span>F2FE</td>
<td class="bytes">9D 59 02</td>
<td class="instruction">STA $0259,X</td>
<td class="comment-1" rowspan="1">save logical file number over closed file</td>
</tr>
<tr>
<td class="address-1"><span id="F301"></span>F301</td>
<td class="bytes">B9 63 02</td>
<td class="instruction">LDA $0263,Y</td>
<td class="comment-1" rowspan="1">get last+1 device number from device number table</td>
</tr>
<tr>
<td class="address-1"><span id="F304"></span>F304</td>
<td class="bytes">9D 63 02</td>
<td class="instruction">STA $0263,X</td>
<td class="comment-1" rowspan="1">save device number over closed file</td>
</tr>
<tr>
<td class="address-1"><span id="F307"></span>F307</td>
<td class="bytes">B9 6D 02</td>
<td class="instruction">LDA $026D,Y</td>
<td class="comment-1" rowspan="1">get last+1 secondary address from secondary address table</td>
</tr>
<tr>
<td class="address-1"><span id="F30A"></span>F30A</td>
<td class="bytes">9D 6D 02</td>
<td class="instruction">STA $026D,X</td>
<td class="comment-1" rowspan="1">save secondary address over closed file</td>
</tr>
<tr>
<td class="address-2"><span id="F30D"></span>F30D</td>
<td class="bytes">18</td>
<td class="instruction">CLC</td>
<td class="comment-1" rowspan="1">flag ok</td>
</tr>
<tr>
<td class="address-1"><span id="F30E"></span>F30E</td>
<td class="bytes">60</td>
<td class="instruction">RTS</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="F2EE.html">F2EE</a>
</td>
<td class="up">Up: <a href="../maps/all.html#F2F2">Map</a></td>
<td class="next">
Next: <a href="F30F.html">F30F</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&#169; 2012 Lee Davison.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.0 and <a href="https://github.com/skoolkid/sk6502">sk6502</a>.</div>
</footer>
</body>
</html>