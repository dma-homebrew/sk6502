<!DOCTYPE html>
<html>
<head>
<title>C64 ROM: Routine at ED21</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html">C64 ROM</a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="ED11.html">ED11</a>
</td>
<td class="up">Up: <a href="../maps/all.html#ED21">Map</a></td>
<td class="next">
Next: <a href="ED40.html">ED40</a>
</td>
</tr>
</table>
<div class="description">ED21: defer a command</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="ED21"></span>ED21</td>
<td class="bytes">85 95</td>
<td class="instruction">STA $95</td>
<td class="comment-1" rowspan="1">save as serial defered character</td>
</tr>
<tr>
<td class="address-1"><span id="ED23"></span>ED23</td>
<td class="bytes">78</td>
<td class="instruction">SEI</td>
<td class="comment-1" rowspan="1">disable the interrupts</td>
</tr>
<tr>
<td class="address-1"><span id="ED24"></span>ED24</td>
<td class="bytes">20 97 EE</td>
<td class="instruction">JSR <a href="EE97.html">$EE97</a></td>
<td class="comment-1" rowspan="1">set the serial data out high</td>
</tr>
<tr>
<td class="address-1"><span id="ED27"></span>ED27</td>
<td class="bytes">C9 3F</td>
<td class="instruction">CMP #$3F</td>
<td class="comment-1" rowspan="1">compare read byte with $3F</td>
</tr>
<tr>
<td class="address-1"><span id="ED29"></span>ED29</td>
<td class="bytes">D0 03</td>
<td class="instruction">BNE <a href="ED21.html#ED2E">$ED2E</a></td>
<td class="comment-1" rowspan="1">branch if not $3F, this branch will always be taken as after VIA 2's PCR is read it is ANDed with $DF, so the result can never be $3F ??</td>
</tr>
<tr>
<td class="address-1"><span id="ED2B"></span>ED2B</td>
<td class="bytes">20 85 EE</td>
<td class="instruction">JSR <a href="EE85.html">$EE85</a></td>
<td class="comment-1" rowspan="1">set the serial clock out high</td>
</tr>
<tr>
<td class="address-2"><span id="ED2E"></span>ED2E</td>
<td class="bytes">AD 00 DD</td>
<td class="instruction">LDA $DD00</td>
<td class="comment-1" rowspan="1">read VIA 2 DRA, serial port and video address</td>
</tr>
<tr>
<td class="address-1"><span id="ED31"></span>ED31</td>
<td class="bytes">09 08</td>
<td class="instruction">ORA #%00001000</td>
<td class="comment-1" rowspan="1">mask xxxx 1xxx, set serial ATN low</td>
</tr>
<tr>
<td class="address-1"><span id="ED33"></span>ED33</td>
<td class="bytes">8D 00 DD</td>
<td class="instruction">STA $DD00</td>
<td class="comment-1" rowspan="1">save VIA 2 DRA, serial port and video address</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="ED36"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routines at <a href="EDB9.html">EDB9</a> and <a href="EDC7.html">EDC7</a>.
</div>
<div class="paragraph">
if the code drops through to here the serial clock is low and the serial data has been released so the following code will have no effect apart from delaying the first byte by 1ms
</div>
<div class="paragraph">
set the serial clk/data, wait and Tx byte on the serial bus
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="ED36"></span>ED36</td>
<td class="bytes">78</td>
<td class="instruction">SEI</td>
<td class="comment-1" rowspan="1">disable the interrupts</td>
</tr>
<tr>
<td class="address-1"><span id="ED37"></span>ED37</td>
<td class="bytes">20 8E EE</td>
<td class="instruction">JSR <a href="EE8E.html">$EE8E</a></td>
<td class="comment-1" rowspan="1">set the serial clock out low</td>
</tr>
<tr>
<td class="address-1"><span id="ED3A"></span>ED3A</td>
<td class="bytes">20 97 EE</td>
<td class="instruction">JSR <a href="EE97.html">$EE97</a></td>
<td class="comment-1" rowspan="1">set the serial data out high</td>
</tr>
<tr>
<td class="address-1"><span id="ED3D"></span>ED3D</td>
<td class="bytes">20 B3 EE</td>
<td class="instruction">JSR <a href="EEB3.html">$EEB3</a></td>
<td class="comment-1" rowspan="1">1ms delay</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="ED11.html">ED11</a>
</td>
<td class="up">Up: <a href="../maps/all.html#ED21">Map</a></td>
<td class="next">
Next: <a href="ED40.html">ED40</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&#169; 2012 Lee Davison.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.0 and <a href="https://github.com/skoolkid/sk6502">sk6502</a>.</div>
</footer>
</body>
</html>